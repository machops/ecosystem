---
apiVersion: v1
data:
  defaultTriggers: '- on-sync-succeeded

    - on-sync-failed

    - on-health-degraded

    '
  service.slack: 'token: $slack-token

    signingSecret: $slack-signing-secret

    '
  service.webhook.eco-base: "url: $webhook-url\nheaders:\n  - name: Content-Type\n\
    \    value: application/json\n  - name: X-eco-base-Event\n    value: argocd-sync\n"
  subscriptions: "- recipients:\n    - slack:eco-base-deployments\n    - webhook:eco-base\n\
    \  triggers:\n    - on-sync-succeeded\n    - on-sync-failed\n    - on-health-degraded\n\
    \    - on-sync-running"
  template.app-health-degraded: "slack:\n  attachments: |\n    [{\n      \"color\"\
    : \"#ff9800\",\n      \"title\": \"⚠️ {{ .app.metadata.name }} — Health Degraded\"\
    ,\n      \"fields\": [\n        {\"title\": \"Application\", \"value\": \"{{ .app.metadata.name\
    \ }}\", \"short\": true},\n        {\"title\": \"Health\", \"value\": \"{{ .app.status.health.status\
    \ }}\", \"short\": true},\n        {\"title\": \"Namespace\", \"value\": \"{{\
    \ .app.spec.destination.namespace }}\", \"short\": true}\n      ],\n      \"footer\"\
    : \"eco-base GitOps | Argo CD\"\n    }]\n"
  template.app-sync-failed: "slack:\n  attachments: |\n    [{\n      \"color\": \"\
    #e53935\",\n      \"title\": \"❌ {{ .app.metadata.name }} — Sync Failed\",\n \
    \     \"fields\": [\n        {\"title\": \"Application\", \"value\": \"{{ .app.metadata.name\
    \ }}\", \"short\": true},\n        {\"title\": \"Namespace\", \"value\": \"{{\
    \ .app.spec.destination.namespace }}\", \"short\": true},\n        {\"title\"\
    : \"Revision\", \"value\": \"{{ .app.status.sync.revision | trunc 7 }}\", \"short\"\
    : true},\n        {\"title\": \"Error\", \"value\": \"{{ .app.status.operationState.message\
    \ | trunc 200 }}\", \"short\": false}\n      ],\n      \"footer\": \"eco-base\
    \ GitOps | Argo CD\"\n    }]\nwebhook:\n  eco-base:\n    method: POST\n    body:\
    \ |\n      {\n        \"event\": \"sync-failed\",\n        \"app\": \"{{ .app.metadata.name\
    \ }}\",\n        \"namespace\": \"{{ .app.spec.destination.namespace }}\",\n \
    \       \"revision\": \"{{ .app.status.sync.revision }}\",\n        \"error\"\
    : \"{{ .app.status.operationState.message }}\",\n        \"timestamp\": \"{{ .app.status.operationState.finishedAt\
    \ }}\"\n      }\n"
  template.app-sync-running: "slack:\n  attachments: |\n    [{\n      \"color\": \"\
    #2196f3\",\n      \"title\": \"\U0001F504 {{ .app.metadata.name }} — Sync In Progress\"\
    ,\n      \"fields\": [\n        {\"title\": \"Application\", \"value\": \"{{ .app.metadata.name\
    \ }}\", \"short\": true},\n        {\"title\": \"Revision\", \"value\": \"{{ .app.status.sync.revision\
    \ | trunc 7 }}\", \"short\": true}\n      ],\n      \"footer\": \"eco-base GitOps\
    \ | Argo CD\"\n    }]\n"
  template.app-sync-succeeded: "slack:\n  attachments: |\n    [{\n      \"color\"\
    : \"#18be52\",\n      \"title\": \"✅ {{ .app.metadata.name }} — Sync Succeeded\"\
    ,\n      \"fields\": [\n        {\"title\": \"Application\", \"value\": \"{{ .app.metadata.name\
    \ }}\", \"short\": true},\n        {\"title\": \"Namespace\", \"value\": \"{{\
    \ .app.spec.destination.namespace }}\", \"short\": true},\n        {\"title\"\
    : \"Revision\", \"value\": \"{{ .app.status.sync.revision | trunc 7 }}\", \"short\"\
    : true},\n        {\"title\": \"Status\", \"value\": \"{{ .app.status.sync.status\
    \ }}\", \"short\": true}\n      ],\n      \"footer\": \"eco-base GitOps | Argo\
    \ CD\",\n      \"footer_icon\": \"https://argo-cd.readthedocs.io/en/stable/assets/logo.png\"\
    \n    }]\nwebhook:\n  eco-base:\n    method: POST\n    body: |\n      {\n    \
    \    \"event\": \"sync-succeeded\",\n        \"app\": \"{{ .app.metadata.name\
    \ }}\",\n        \"namespace\": \"{{ .app.spec.destination.namespace }}\",\n \
    \       \"revision\": \"{{ .app.status.sync.revision }}\",\n        \"timestamp\"\
    : \"{{ .app.status.operationState.finishedAt }}\"\n      }\n"
  trigger.on-health-degraded: "- when: app.status.health.status == 'Degraded'\n  send:\
    \ [app-health-degraded]\n"
  trigger.on-sync-failed: "- when: app.status.operationState.phase in ['Error', 'Failed']\n\
    \  send: [app-sync-failed]\n"
  trigger.on-sync-running: "- when: app.status.operationState.phase in ['Running']\n\
    \  send: [app-sync-running]\n"
  trigger.on-sync-succeeded: "- when: app.status.operationState.phase in ['Succeeded']\n\
    \  send: [app-sync-succeeded]\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/uri: eco-base://k8s/core/configmap/argocd-notifications-cm
    eco-base/urn: urn:eco-base:k8s:core:configmap:argocd-notifications-cm:sha256-657dd82f2d928df7f0e0eaede9b1898ff31200cc29d9af4b72c056a1007781de
  labels:
    app.kubernetes.io/name: argocd-notifications
    app.kubernetes.io/part-of: eco-base
  name: argocd-notifications-cm
  namespace: argocd
