---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    app: eco-base
    component: federation
  name: fleet-management
---
apiVersion: v1
data:
  clusters.yaml: "clusters:\n  - name: production-us-east-1\n    apiEndpoint: https://api.prod-useast.eco-base.platform\n\
    \    location: us-east-1\n    provider: AWS\n    environment: production\n   \
    \ capabilities:\n      - quantum-computing\n      - ml-inference\n      - vector-database\n\
    \    capacity:\n      cpu: \"1000\"\n      memory: \"4000Gi\"\n      nodes: 50\n\
    \    status: active\n    health: healthy\n    lastSync: \"2024-02-11T10:00:00Z\"\
    \n  \n  - name: production-eu-central-1\n    apiEndpoint: https://api.prod-eu.eco-base.platform\n\
    \    location: eu-central-1\n    provider: AWS\n    environment: production\n\
    \    capabilities:\n      - quantum-computing\n      - ml-training\n      - data-processing\n\
    \    capacity:\n      cpu: \"800\"\n      memory: \"3200Gi\"\n      nodes: 40\n\
    \    status: active\n    health: healthy\n    lastSync: \"2024-02-11T10:00:00Z\"\
    \n  \n  - name: staging-us-west-2\n    apiEndpoint: https://api.staging-uswest.eco-base.platform\n\
    \    location: us-west-2\n    provider: AWS\n    environment: staging\n    capabilities:\n\
    \      - ml-inference\n      - data-processing\n    capacity:\n      cpu: \"200\"\
    \n      memory: \"800Gi\"\n      nodes: 10\n    status: active\n    health: healthy\n\
    \    lastSync: \"2024-02-11T10:00:00Z\"\n  \n  - name: development-ap-southeast-1\n\
    \    apiEndpoint: https://api.dev-apse.eco-base.platform\n    location: ap-southeast-1\n\
    \    provider: AWS\n    environment: development\n    capabilities:\n      - development\n\
    \      - testing\n    capacity:\n      cpu: \"100\"\n      memory: \"400Gi\"\n\
    \      nodes: 5\n    status: active\n    health: healthy\n    lastSync: \"2024-02-11T10:00:00Z\"\
    \n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/cluster-registry
    eco-base/urn: urn:eco-base:k8s:core:configmap:cluster-registry:sha256-f8ad93a9f8d9d102b5a8e37327f081d7980f5dffee2a90a7c0978e9221562699
  labels:
    app: eco-base
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: cluster-registry
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: federation
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: cluster-registry
  namespace: fleet-management
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/secret/cluster-secrets
    eco-base/urn: urn:eco-base:k8s:core:secret:cluster-secrets:sha256-f1213b66f508423b58acf607ba7acc511ab2659717c76a374d795165cc8bce88
  labels:
    app: eco-base
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: cluster-secrets
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: federation
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: cluster-secrets
  namespace: fleet-management
stringData:
  production-eu-central-1-kubeconfig: "apiVersion: v1\nkind: Config\nclusters:\n-\
    \ cluster:\n    certificate-authority-data: BASE64_ENCODED_CA_DATA\n    server:\
    \ https://api.prod-eu.eco-base.platform\n  name: production-eu-central-1\ncontexts:\n\
    - context:\n    cluster: production-eu-central-1\n    user: production-admin\n\
    \  name: production-eu-central-1\nusers:\n- name: production-admin\n  user:\n\
    \    token: SERVICE_ACCOUNT_TOKEN\n"
  production-us-east-1-kubeconfig: "apiVersion: v1\nkind: Config\nclusters:\n- cluster:\n\
    \    certificate-authority-data: BASE64_ENCODED_CA_DATA\n    server: https://api.prod-useast.eco-base.platform\n\
    \  name: production-us-east-1\ncontexts:\n- context:\n    cluster: production-us-east-1\n\
    \    user: production-admin\n  name: production-us-east-1\nusers:\n- name: production-admin\n\
    \  user:\n    token: SERVICE_ACCOUNT_TOKEN\n"
type: Opaque
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/deployment/cluster-registry-operator
    eco-base/urn: urn:eco-base:k8s:core:deployment:cluster-registry-operator:sha256-de1205cf0675b7a9e4c6596e734218749c33e1c463f96a7fd4f6fcd10300ee58
  labels:
    app: eco-base
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: cluster-registry-operator
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: federation
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: cluster-registry-operator
  namespace: fleet-management
spec:
  replicas: 2
  selector:
    matchLabels:
      app: cluster-registry-operator
  template:
    metadata:
      labels:
        app: eco-base
        component: federation
    spec:
      containers:
      - args:
        - --config-path=/etc/registry/clusters.yaml
        - --sync-interval=300s
        - --health-check-interval=60s
        env:
        - name: NAMESPACE
          value: fleet-management
        - name: LOG_LEVEL
          value: info
        image: ghcr.io/eco-base/cluster-registry-operator:v0.1.0
        livenessProbe:
          httpGet:
            path: /healthz
            port: metrics
          initialDelaySeconds: 30
          periodSeconds: 10
        name: operator
        ports:
        - containerPort: 8080
          name: metrics
        - containerPort: 8443
          name: api
        readinessProbe:
          httpGet:
            path: /readyz
            port: metrics
          initialDelaySeconds: 30
          periodSeconds: 10
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 100m
            memory: 256Mi
        volumeMounts:
        - mountPath: /etc/registry
          name: config
          readOnly: true
        - mountPath: /etc/secrets
          name: secrets
          readOnly: true
      serviceAccountName: fleet-management
      volumes:
      - configMap:
          name: cluster-registry
        name: config
      - name: secrets
        secret:
          secretName: cluster-secrets
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/service/cluster-registry-service
    eco-base/urn: urn:eco-base:k8s:core:service:cluster-registry-service:sha256-5ed2f3f26820d69f8c7e0ef0d1bdd82d43d4b14ad0b281b0747a535b25237e6f
  labels:
    app: eco-base
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: cluster-registry-service
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: federation
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: cluster-registry-service
  namespace: fleet-management
spec:
  ports:
  - name: metrics
    port: 8080
    targetPort: metrics
  - name: api
    port: 8443
    targetPort: api
  selector:
    app: cluster-registry-operator
  type: ClusterIP
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    app: eco-base
    component: federation
  name: cluster-registry
  namespace: fleet-management
spec:
  endpoints:
  - interval: 30s
    path: /metrics
    port: metrics
  selector:
    matchLabels:
      app: eco-base
      component: federation
