---
apiVersion: v1
data:
  audit-policy.yaml: "# Audit Policy for SuperAI Platform\n# Logs all requests for\
    \ security and compliance\n\napiVersion: audit.k8s.io/v1\nkind: Policy\nrules:\n\
    \  # Log all requests at the Request level\n  - level: Request\n    \n    # Log\
    \ configuration changes\n    verbs: [\"create\", \"update\", \"delete\", \"patch\"\
    ]\n    resources:\n      - group: \"\" # core\n        resources: [\"configmaps\"\
    , \"secrets\", \"pods\", \"services\"]\n      - group: \"apps\"\n        resources:\
    \ [\"deployments\", \"statefulsets\", \"daemonsets\"]\n      - group: \"rbac.authorization.k8s.io\"\
    \n        resources: [\"roles\", \"rolebindings\", \"clusterroles\", \"clusterrolebindings\"\
    ]\n      - group: \"networking.k8s.io\"\n        resources: [\"ingresses\", \"\
    networkpolicies\"]\n    \n    # Log security-sensitive operations\n    verbs:\
    \ [\"impersonate\"]\n    resources: [\"*\"]\n  \n  # Log failed authentication\
    \ attempts\n  - level: Request\n    verbs: [\"create\"]\n    resources:\n    \
    \  - group: \"authentication.k8s.io\"\n        resources: [\"tokenreviews\"]\n\
    \  \n  # Log admission webhooks\n  - level: Request\n    resources:\n      - group:\
    \ \"admissionregistration.k8s.io\"\n        resources: [\"validatingwebhookconfigurations\"\
    , \"mutatingwebhookconfigurations\"]\n  \n  # Log pod exec/attach/port-forward\
    \ (potential security risk)\n  - level: Request\n    verbs: [\"create\", \"connect\"\
    ]\n    resources:\n      - group: \"\"\n        resources: [\"pods/exec\", \"\
    pods/attach\", \"pods/portforward\"]\n  \n  # Log all secrets access\n  - level:\
    \ RequestResponse\n    verbs: [\"get\", \"list\", \"watch\"]\n    resources:\n\
    \      - group: \"\"\n        resources: [\"secrets\"]\n  \n  # Log namespace\
    \ operations\n  - level: Request\n    verbs: [\"create\", \"delete\"]\n    resources:\n\
    \      - group: \"\"\n        resources: [\"namespaces\"]\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/audit-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:audit-config:sha256-fef788507df0a86732572415c18cf9a2c383eaa281b2b49c9c286951994c4a6e
  labels:
    app: superai-platform
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: audit-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: audit
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: audit-config
  namespace: default
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/daemonset/audit-log-sidecar
    eco-base/urn: urn:eco-base:k8s:core:daemonset:audit-log-sidecar:sha256-47d679904b1a75e4b243b41b3f2739403bd9e44ec8ccd02133ed04d98e067c1a
  labels:
    app: superai-platform
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: audit-log-sidecar
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: audit
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: audit-log-sidecar
  namespace: default
spec:
  selector:
    matchLabels:
      app: superai-platform
  template:
    metadata:
      labels:
        app: superai-platform
        component: audit
    spec:
      containers:
      - args:
        - "# Collect application audit logs\nwhile true; do\n  if [ -f /app/logs/audit.log\
          \ ]; then\n    tail -n 0 -f /app/logs/audit.log | while read line; do\n\
          \      echo \"$line\" >> /var/log/audit/application.log\n      \n      #\
          \ Send to Loki for aggregation\n      curl -X POST http://loki.monitoring.svc.cluster.local:3100/loki/api/v1/push\
          \ \\\n        -H \"Content-Type: application/json\" \\\n        -d \"{\n\
          \          &quot;streams&quot;: [\n            {\n              &quot;stream&quot;:\
          \ {\n                &quot;job&quot;: &quot;audit&quot;,\n             \
          \   &quot;app&quot;: &quot;superai-platform&quot;,\n                &quot;level&quot;:\
          \ &quot;audit&quot;\n              },\n              &quot;values&quot;:\
          \ [\n                [&quot;$(date +%s)000000000&quot;, &quot;$line&quot;]\n\
          \              ]\n            }\n          ]\n        }\"\n    done\n  fi\n\
          \  sleep 1\ndone\n"
        command:
        - /bin/sh
        - -c
        image: busybox:1.36
        name: audit-collector
        resources:
          limits:
            cpu: 200m
            memory: 200Mi
            ephemeral-storage: "1Gi"
          requests:
            cpu: 50m
            memory: 100Mi
            ephemeral-storage: "1Gi"
        volumeMounts:
        - mountPath: /app/logs
          name: app-logs
          readOnly: true
        - mountPath: /var/log/audit
          name: audit-storage
      serviceAccountName: superai-monitoring
      volumes:
      - hostPath:
          path: /var/log/superai-platform
          type: DirectoryOrCreate
        name: app-logs
      - hostPath:
          path: /var/log/audit
          type: DirectoryOrCreate
        name: audit-storage
---
apiVersion: batch/v1
kind: CronJob
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/cronjob/audit-log-rotation
    eco-base/urn: urn:eco-base:k8s:core:cronjob:audit-log-rotation:sha256-0d5c5c8a00952ec3deafd8a1f9bdf95d2c3756b2ec0e2e0178d5b66a8f41eda2
  labels:
    app: superai-platform
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: audit-log-rotation
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: audit
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: audit-log-rotation
  namespace: default
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      activeDeadlineSeconds: 600
      backoffLimit: 3
      template:
        spec:
          containers:
          - args:
            - '# Rotate audit logs older than 7 days

              find /var/log/audit -name "*.log" -mtime +7 -exec gzip {} \;

              find /var/log/audit -name "*.gz" -mtime +90 -delete


              # Keep archive of critical audit events

              grep -E "Security|Breach|Attack|Compromise|Unauthorized" /var/log/audit/application.log
              > /var/log/audit/critical-$(date +%Y%m%d).log

              gzip /var/log/audit/critical-$(date +%Y%m%d).log


              echo "Audit log rotation completed at $(date)"

              '
            command:
            - /bin/sh
            - -c
            image: busybox:1.36
            name: log-rotator
            resources:
              limits:
                cpu: 500m
                memory: 500Mi
                ephemeral-storage: "1Gi"
              requests:
                cpu: 100m
                memory: 100Mi
                ephemeral-storage: "1Gi"
            volumeMounts:
            - mountPath: /var/log/audit
              name: audit-storage
          restartPolicy: OnFailure
          serviceAccountName: superai-monitoring
          volumes:
          - hostPath:
              path: /var/log/audit
              type: DirectoryOrCreate
            name: audit-storage
  schedule: 0 0 * * *
  successfulJobsHistoryLimit: 3
---
apiVersion: batch/v1
kind: CronJob
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/cronjob/audit-log-analyzer
    eco-base/urn: urn:eco-base:k8s:core:cronjob:audit-log-analyzer:sha256-6dbbebd2eb55342b17fd624cfbe61f5b91dc5c0fa946ac9e78ecc2ed24b62eda
  labels:
    app: superai-platform
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: audit-log-analyzer
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: audit
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: audit-log-analyzer
  namespace: default
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      activeDeadlineSeconds: 300
      backoffLimit: 1
      template:
        spec:
          containers:
          - args:
            - "# Analyze recent audit logs for suspicious activity\n\n# Check for\
              \ failed authentication attempts\nFAILED_AUTH=$(grep -c \"authentication.*failed\"\
              \ /var/log/audit/application.log 2>/dev/null || echo \"0\")\n\n# Check\
              \ for unauthorized access attempts\nUNAUTHORIZED=$(grep -c \"401\\|403\"\
              \ /var/log/audit/application.log 2>/dev/null || echo \"0\")\n\n# Check\
              \ for security events\nSECURITY_EVENTS=$(grep -cE \"Security|Breach|Attack|Compromise\"\
              \ /var/log/audit/application.log 2>/dev/null || echo \"0\")\n\n# Check\
              \ for privilege escalation attempts\nPRIVILEGE_ESCALATION=$(grep -cE\
              \ \"privilege|escalation|sudo|root\" /var/log/audit/application.log\
              \ 2>/dev/null || echo \"0\")\n\n# Send metrics to Prometheus Pushgateway\n\
              cat <<EOF | curl --data-binary @- http://pushgateway.monitoring.svc.cluster.local:9091/metrics/job/audit_analyzer/instance/$(hostname)\n\
              # HELP failed_auth_attempts_total Number of failed authentication attempts\n\
              # TYPE failed_auth_attempts_total gauge\nfailed_auth_attempts_total\
              \ ${FAILED_AUTH}\n\n# HELP unauthorized_access_attempts_total Number\
              \ of unauthorized access attempts\n# TYPE unauthorized_access_attempts_total\
              \ gauge\nunauthorized_access_attempts_total ${UNAUTHORIZED}\n\n# HELP\
              \ security_events_total Number of security events detected\n# TYPE security_events_total\
              \ gauge\nsecurity_events_total ${SECURITY_EVENTS}\n\n# HELP privilege_escalation_attempts_total\
              \ Number of privilege escalation attempts\n# TYPE privilege_escalation_attempts_total\
              \ gauge\nprivilege_escalation_attempts_total ${PRIVILEGE_ESCALATION}\n\
              EOF\n\n# Alert if thresholds exceeded\nif [ ${SECURITY_EVENTS} -gt 5\
              \ ]; then\n  echo \"WARNING: High number of security events detected:\
              \ ${SECURITY_EVENTS}\"\nfi\n\necho \"Audit log analysis completed at\
              \ $(date)\"\n"
            command:
            - /bin/sh
            - -c
            image: curlimages/curl:8.5.0
            name: analyzer
            resources:
              limits:
                cpu: 500m
                memory: 500Mi
                ephemeral-storage: "1Gi"
              requests:
                cpu: 100m
                memory: 100Mi
                ephemeral-storage: "1Gi"
            volumeMounts:
            - mountPath: /var/log/audit
              name: audit-storage
          restartPolicy: OnFailure
          serviceAccountName: superai-monitoring
          volumes:
          - hostPath:
              path: /var/log/audit
              type: DirectoryOrCreate
            name: audit-storage
  schedule: '*/30 * * * *'
  successfulJobsHistoryLimit: 3
---
apiVersion: v1
data:
  retention.yaml: "# Audit Log Retention Policy\n# Compliant with SOC 2, HIPAA, and\
    \ GDPR requirements\n\nretention_rules:\n  # Critical security events - 7 years\n\
    \  - category: \"security_critical\"\n    severity: [\"critical\", \"high\"]\n\
    \    retention_days: 2555  # 7 years\n    archive: true\n    encryption: true\n\
    \  \n  # Security events - 3 years\n  - category: \"security\"\n    severity:\
    \ [\"warning\"]\n    retention_days: 1095  # 3 years\n    archive: true\n    encryption:\
    \ true\n  \n  # Operational events - 1 year\n  - category: \"operational\"\n \
    \   severity: [\"info\", \"notice\"]\n    retention_days: 365  # 1 year\n    archive:\
    \ false\n    encryption: false\n  \n  # Debug events - 90 days\n  - category:\
    \ \"debug\"\n    severity: [\"debug\"]\n    retention_days: 90\n    archive: false\n\
    \    encryption: false\n\n# Log compression\ncompression:\n  enabled: true\n \
    \ algorithm: gzip\n  threshold_days: 7  # Compress logs older than 7 days\n\n\
    # Archive storage\narchive:\n  enabled: true\n  location: \"s3://audit-logs-backup\"\
    \n  encryption: \"AES256\"\n  retention_days: 2555  # 7 years\n\n# Compliance\
    \ requirements\ncompliance:\n  soc2:\n    enabled: true\n    retention_days: 1825\
    \  # 5 years\n  \n  hipaa:\n    enabled: true\n    retention_days: 2555  # 7 years\n\
    \  \n  gdpr:\n    enabled: true\n    retention_days: 2555  # 7 years\n    data_subject_access:\
    \ true\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/audit-retention-policy
    eco-base/urn: urn:eco-base:k8s:core:configmap:audit-retention-policy:sha256-feaa2fdf8c5d1c487e2264b50b099ea9863347c54deb71d4846108b788034fa0
  labels:
    app: superai-platform
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: audit-retention-policy
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: audit
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: audit-retention-policy
  namespace: default
---
apiVersion: v1
data:
  audit-dashboard.json: "{\n  \"dashboard\": {\n    \"title\": \"Audit Logs Dashboard\"\
    ,\n    \"tags\": [\"audit\", \"security\", \"compliance\"],\n    \"timezone\"\
    : \"browser\",\n    \"panels\": [\n      {\n        \"id\": 1,\n        \"title\"\
    : \"Failed Authentication Attempts\",\n        \"type\": \"graph\",\n        \"\
    targets\": [\n          {\n            \"expr\": \"failed_auth_attempts_total\"\
    ,\n            \"legendFormat\": \"Failed Auth\"\n          }\n        ],\n  \
    \      \"gridPos\": {\"h\": 8, \"w\": 12, \"x\": 0, \"y\": 0}\n      },\n    \
    \  {\n        \"id\": 2,\n        \"title\": \"Security Events\",\n        \"\
    type\": \"graph\",\n        \"targets\": [\n          {\n            \"expr\"\
    : \"security_events_total\",\n            \"legendFormat\": \"Security Events\"\
    \n          }\n        ],\n        \"gridPos\": {\"h\": 8, \"w\": 12, \"x\": 12,\
    \ \"y\": 0}\n      },\n      {\n        \"id\": 3,\n        \"title\": \"Unauthorized\
    \ Access Attempts\",\n        \"type\": \"graph\",\n        \"targets\": [\n \
    \         {\n            \"expr\": \"unauthorized_access_attempts_total\",\n \
    \           \"legendFormat\": \"Unauthorized\"\n          }\n        ],\n    \
    \    \"gridPos\": {\"h\": 8, \"w\": 12, \"x\": 0, \"y\": 8}\n      },\n      {\n\
    \        \"id\": 4,\n        \"title\": \"Privilege Escalation Attempts\",\n \
    \       \"type\": \"graph\",\n        \"targets\": [\n          {\n          \
    \  \"expr\": \"privilege_escalation_attempts_total\",\n            \"legendFormat\"\
    : \"Privilege Escalation\"\n          }\n        ],\n        \"gridPos\": {\"\
    h\": 8, \"w\": 12, \"x\": 12, \"y\": 8}\n      },\n      {\n        \"id\": 5,\n\
    \        \"title\": \"Recent Audit Events\",\n        \"type\": \"logs\",\n  \
    \      \"targets\": [\n          {\n            \"expr\": \"{namespace=&quot;default&quot;,\
    \ job=&quot;audit&quot;}\",\n            \"refId\": \"A\"\n          }\n     \
    \   ],\n        \"gridPos\": {\"h\": 8, \"w\": 24, \"x\": 0, \"y\": 16}\n    \
    \  }\n    ]\n  }\n}"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/grafana-dashboard-audit
    eco-base/urn: urn:eco-base:k8s:core:configmap:grafana-dashboard-audit:sha256-0e7782e488b6d8b6ca92b0837d97d38ddbda5281f1d5a75c7262ea56461a6e10
  labels:
    app: superai-platform
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: grafana-dashboard-audit
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    component: audit
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
    grafana_dashboard: '1'
  name: grafana-dashboard-audit
  namespace: monitoring
