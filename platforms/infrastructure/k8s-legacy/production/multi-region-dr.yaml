---
apiVersion: v1
data:
  dr-policy.yaml: "# Multi-region disaster recovery policy\ndisasterRecovery:\n  enabled:\
    \ true\n  \n  # Regional infrastructure\n  regions:\n    primary:\n      name:\
    \ us-east-1\n      role: active\n      datacenters:\n        - name: us-east-1a\n\
    \          zone: a\n          role: primary\n        - name: us-east-1b\n    \
    \      zone: b\n          role: secondary\n        - name: us-east-1c\n      \
    \    zone: c\n          role: secondary\n      resources:\n        replicas: 9\
    \  # 3 per zone\n        storage: regional\n        database: active-active\n\
    \    \n    dr1:\n      name: us-west-2\n      role: hot-standby\n      datacenters:\n\
    \        - name: us-west-2a\n          zone: a\n          role: primary\n    \
    \    - name: us-west-2b\n          zone: b\n          role: secondary\n      \
    \  - name: us-west-2c\n          zone: c\n          role: secondary\n      resources:\n\
    \        replicas: 6  # 2 per zone\n        storage: regional\n        database:\
    \ active-standby\n      failoverPriority: 1\n    \n    dr2:\n      name: eu-west-1\n\
    \      role: warm-standby\n      datacenters:\n        - name: eu-west-1a\n  \
    \        zone: a\n          role: primary\n        - name: eu-west-1b\n      \
    \    zone: b\n          role: secondary\n        - name: eu-west-1c\n        \
    \  zone: c\n          role: secondary\n      resources:\n        replicas: 3 \
    \ # 1 per zone\n        storage: standard\n        database: stand-alone\n   \
    \   failoverPriority: 2\n  \n  # Active-Active deployment configuration\n  activeActive:\n\
    \    enabled: true\n    regions:\n      - us-east-1\n      - us-west-2\n    trafficDistribution:\n\
    \      us-east-1: 70  # 70% to primary\n      us-west-2: 30  # 30% to DR1\n  \
    \  dataConsistency:\n      mode: eventual\n      syncInterval: 5s\n      conflictResolution:\
    \ timestamp-based\n    healthChecks:\n      enabled: true\n      interval: 10s\n\
    \      timeout: 5s\n      unhealthyThreshold: 3\n  \n  # Failover configuration\n\
    \  failover:\n    enabled: true\n    mode: automatic  # automatic | manual\n \
    \   triggers:\n      - name: regional-failure\n        type: regional\n      \
    \  enabled: true\n        criteria:\n          unhealthyZones: 2  # Failover if\
    \ 2+ zones are unhealthy\n          unhealthyDuration: 5m\n        action:\n \
    \         type: traffic-redirect\n          targetRegion: dr1\n      - name: database-failure\n\
    \        type: database\n        enabled: true\n        criteria:\n          unhealthyReplicas:\
    \ 2\n          unhealthyDuration: 3m\n        action:\n          type: database-failover\n\
    \          targetRegion: dr1\n      - name: health-check-failure\n        type:\
    \ health\n        enabled: true\n        criteria:\n          failureRate: 50\
    \  # 50% failure rate\n          duration: 5m\n        action:\n          type:\
    \ traffic-redirect\n          targetRegion: dr1\n    coolDown: 300s  # 5 minutes\
    \ cooldown between failovers\n    maxFailoversPerHour: 1\n  \n  # Failback configuration\n\
    \  failback:\n    enabled: true\n    mode: manual  # Require manual approval\n\
    \    prerequisites:\n      - sourceRegionHealthy: true\n      - duration: 4h \
    \ # Wait 4 hours before failback\n      - manualApproval: true\n    notification:\n\
    \      channels:\n        - slack\n        - email\n        - pagerduty\n  \n\
    \  # Cross-region replication\n  replication:\n    enabled: true\n    mode: async\n\
    \    latency: 5s\n    compression: true\n    encryption: true\n    consistency:\n\
    \      mode: eventual\n      conflictResolution: last-write-wins\n    resources:\n\
    \      database:\n        enabled: true\n        type: postgresql-logical\n  \
    \      slotNames:\n          - machine_native_ops_replication_slot\n      storage:\n\
    \        enabled: true\n        type: s3-replication\n        bucketPrefix: replicated-data/\n\
    \      cache:\n        enabled: true\n        type: redis-replication\n      \
    \  mode: master-slave\n  \n  # Disaster recovery testing\n  testing:\n    enabled:\
    \ true\n    schedule:\n      failoverDrill: \"0 3 * * 1\"  # Weekly on Monday\
    \ at 3 AM UTC\n      fullDrTest: \"0 3 1 * *\"  # Monthly on 1st at 3 AM UTC\n\
    \    notification:\n      before: 24h\n      after: 1h\n      channels:\n    \
    \    - slack\n        - email\n    results:\n      retention: 365d\n      storage:\
    \ s3\n      bucket: dr-test-results/"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/multi-region-dr-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:multi-region-dr-config:sha256-26c7e9068140ad15dbf05a0c755f75c1fbeb853feab801a21e76e53f7b1c1192
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: multi-region-dr-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: multi-region-dr-config
  namespace: production
