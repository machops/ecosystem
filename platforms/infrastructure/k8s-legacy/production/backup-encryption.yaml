---
apiVersion: v1
data:
  encryption-policy.yaml: "# Backup encryption policy\nencryption:\n  enabled: true\n\
    \  \n  # Encryption at rest\n  atRest:\n    algorithm: AES256-GCM\n    keyManagement:\n\
    \      type: AWS-KMS\n      keyArn: arn:aws:kms:us-east-1:123456789012:key/abcd1234-5678-90ab-cdef-1234567890ab\n\
    \      region: us-east-1\n    keyRotation:\n      enabled: true\n      schedule:\
    \ \"0 0 1 * *\"  # Monthly on 1st day\n      retention: 2  # Keep 2 versions of\
    \ keys\n  \n  # Encryption in transit\n  inTransit:\n    protocol: TLSv1.2\n \
    \   cipherSuites:\n      - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\n      - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n\
    \    minVersion: TLSv1.2\n    maxVersion: TLSv1.3\n    certificateVerification:\
    \ strict\n    caBundle: /etc/ssl/certs/ca-certificates.crt\n  \n  # Encryption\
    \ settings per backup type\n  perBackupType:\n    fullCluster:\n      atRest:\
    \ true\n      inTransit: true\n      compression: true\n      compressionAlgorithm:\
    \ gzip\n    incremental:\n      atRest: true\n      inTransit: true\n      compression:\
    \ false\n    database:\n      atRest: true\n      inTransit: true\n      compression:\
    \ true\n      compressionAlgorithm: zstd\n    configuration:\n      atRest: true\n\
    \      inTransit: true\n      compression: false\n  \n  # Key management for cross-region\
    \ replication\n  crossRegionEncryption:\n    enabled: true\n    strategy: region-isolated\
    \  # Each region uses its own KMS key\n    regions:\n      us-east-1:\n      \
    \  keyArn: arn:aws:kms:us-east-1:123456789012:key/key1\n      us-west-2:\n   \
    \     keyArn: arn:aws:kms:us-west-2:123456789012:key/key2\n      eu-west-1:\n\
    \        keyArn: arn:aws:kms:eu-west-1:123456789012:key/key3\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/backup-encryption-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:backup-encryption-config:sha256-e6b9ac60830677e55390b22c23084fea91b9876a70208787ca70083a4217dcdb
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: backup-encryption-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: backup-encryption-config
  namespace: velero
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/secret/velero-encryption-keys
    eco-base/urn: urn:eco-base:k8s:core:secret:velero-encryption-keys:sha256-cd7eb54cbb005dd0dd311b7d846909705d38604a619df756d0e7333e455f7eba
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: velero-encryption-keys
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: velero-encryption-keys
  namespace: velero
stringData:
  cross-region-keys.yaml: 'us-east-1-key: arn:aws:kms:us-east-1:123456789012:key/key1

    us-west-2-key: arn:aws:kms:us-west-2:123456789012:key/key2

    eu-west-1-key: arn:aws:kms:eu-west-1:123456789012:key/key3

    '
  encryption-key: '-----BEGIN ENCRYPTION KEY-----

    # Generated encryption key for backup encryption

    # This is a placeholder - use AWS KMS in production

    aes-256-key: your-generated-aes-256-key-here

    key-version: 1

    key-created: "2026-01-27T00:00:00Z"

    key-expires: "2026-04-27T00:00:00Z"

    -----END ENCRYPTION KEY-----

    '
type: Opaque
---
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/production/backup-encryption.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:production:backup-encryption.yaml
  name: primary-backup
  namespace: velero
spec:
  accessMode: ReadWrite
  config:
    encryptionEnabled: true
    kmsKeyId: arn:aws:kms:us-east-1:123456789012:key/abcd1234-5678-90ab-cdef-1234567890ab
    region: us-east-1
    s3Url: https://s3.us-east-1.amazonaws.com
  objectStorage:
    bucket: machine-native-ops-backups-primary
    prefix: backups
  provider: aws
---
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/production/backup-encryption.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:production:backup-encryption.yaml
  name: dr-backup-us-west-2
  namespace: velero
spec:
  accessMode: ReadWrite
  config:
    encryptionEnabled: true
    kmsKeyId: arn:aws:kms:us-west-2:123456789012:key/efgh5678-9012-34cd-efgh-567890123456
    region: us-west-2
    s3Url: https://s3.us-west-2.amazonaws.com
  objectStorage:
    bucket: machine-native-ops-backups-dr
    prefix: backups
  provider: aws
---
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/production/backup-encryption.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:production:backup-encryption.yaml
  name: dr-backup-eu-west-1
  namespace: velero
spec:
  accessMode: ReadWrite
  config:
    encryptionEnabled: true
    kmsKeyId: arn:aws:kms:eu-west-1:123456789012:key/ijkl9012-3456-78ef-ghij-901234567890
    region: eu-west-1
    s3Url: https://s3.eu-west-1.amazonaws.com
  objectStorage:
    bucket: machine-native-ops-backups-eu
    prefix: backups
  provider: aws
