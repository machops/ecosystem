---
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/jaeger/istio-config.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:jaeger:istio-config.yaml
  name: istio-tracing-config
  namespace: istio-system
spec:
  meshConfig:
    defaultConfig:
      maxSpanDuration: 10s
      otlpConfig:
        otlp:
          address: jaeger-collector.jaeger.svc:4317
          propagators:
          - tracecontext
          - baggage
          - b3
          resource:
            deployment.environment: production
            service.name: machine-native-ops
            telemetry.sdk.language: python
            telemetry.sdk.name: opentelemetry
            telemetry.sdk.version: 1.20.0
          tls:
            insecure: true
        trace_exporters:
        - otlp
      tracing:
        custom_tags:
          cluster:
            environment:
              value: us-east-1
          environment:
            environment:
              value: production
          version:
            environment:
              value: v1.0.0
        sampling: 10.0
      zipkin:
        address: zipkin.istio-system:9411
    enableTracing: true
---
apiVersion: v1
data:
  tracing.yaml: "tracing:\n  enabled: true\n  exporter: jaeger\n  jaeger:\n    agent_host:\
    \ jaeger-agent.jaeger.svc\n    agent_port: 6831\n    collector_host: jaeger-collector.jaeger.svc\n\
    \    collector_port: 14250\n    endpoint: http://jaeger-collector.jaeger.svc:14268/api/traces\n\
    \    # Sampling configuration\n    sampler:\n      type: probabilistic\n     \
    \ param: 0.1  # 10% sampling\n    # Tags to include in all spans\n    tags:\n\
    \      app.kubernetes.io/name: machine-native-ops\n      environment: production\n\
    \      version: \"1.0.0\"\n    # Span options\n    span:\n      max_queue_size:\
    \ 2048\n      schedule_delay_millis: 5000\n      export_timeout_millis: 30000\n\
    \      max_export_batch_size: 512\n    # Logging integration\n    logging:\n \
    \     enabled: true\n      level: info\n      log_spans: true\n      log_payloads:\
    \ false\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/jaeger-tracing-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:jaeger-tracing-config:sha256-b4f7d80b9b0508ad3f0d955e03853c4a974ff858be8a25026d7f3f456e5d1439
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: jaeger-tracing-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: jaeger-tracing-config
  namespace: platform-03
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/jaeger/istio-config.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:jaeger:istio-config.yaml
  name: mesh-tracing
  namespace: istio-system
spec:
  selector:
    matchLabels:
      istio-injection: enabled
  tracing:
  - customTags:
      request.id:
        environment:
          name: X-Request-ID
      service.name:
        environment:
          name: SERVICE_NAME
      tenant.id:
        environment:
          name: X-Tenant-ID
      user.id:
        environment:
          name: X-User-ID
    providers:
    - name: jaeger
    randomSamplingPercentage: 10.0
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/jaeger/istio-config.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:jaeger:istio-config.yaml
  name: machine-native-ops-tracing
  namespace: platform-03
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: machine-native-ops
  tracing:
  - customTags:
      service.type:
        literal:
          value: critical
      sla.target:
        literal:
          value: p95:100ms,p99:500ms
    providers:
    - name: jaeger
    randomSamplingPercentage: 100.0
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/jaeger/istio-config.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:jaeger:istio-config.yaml
  name: background-services-tracing
  namespace: platform-03
spec:
  selector:
    matchLabels:
      type: background
  tracing:
  - customTags:
      service.type:
        literal:
          value: background
    providers:
    - name: jaeger
    randomSamplingPercentage: 1.0
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/k8s-legacy/jaeger/istio-config.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:k8s-legacy:jaeger:istio-config.yaml
  name: access-logging
  namespace: istio-system
spec:
  accessLogging:
  - filter:
      expression: request.url_path != "/health" &amp;&amp; request.url_path != "/metrics"
    providers:
    - name: envoy
  selector:
    matchLabels:
      istio-injection: enabled
