# @ECO-governed
# @ECO-layer: infrastructure
# @ECO-semantic: grafana-dashboards
# @ECO-audit-trail: ../../engine/governance/GL_SEMANTIC_ANCHOR.json
# 
# GL Unified Architecture Governance Framework Activated

apiVersion: v1
kind: ConfigMap
metadata:
  annotations:
    eco-base/urn: "urn:eco-base:platform:resource:infrastructure:foundation:k8s-legacy:production:grafana-dashboards.yaml"
    eco-base/uri: "eco-base://platform/resource/infrastructure/foundation/k8s-legacy/production/grafana-dashboards.yaml"
  name: grafana-dashboards
  namespace: monitoring
  labels:
    eco-base/part-of: eco-base
    eco-base/governance: aligned
    app.kubernetes.io/name: grafana
    environment: production
data:
  machine-native-ops-dashboard.json: |
    {
      "dashboard": {
        "title": "Machine Native Ops - Production",
        "uid": "machine-native-ops-prod",
        "tags": ["machine-native-ops", "production"],
        "timezone": "browser",
        "refresh": "30s",
        "panels": [
          {
            "title": "Request Rate",
            "targets": [
              {
                "expr": "sum(rate(http_requests_total{job=&quot;machine-native-ops&quot;}[5m])) by (status)",
                "legendFormat": "{{ status }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "title": "Response Time",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job=&quot;machine-native-ops&quot;}[5m]))",
                "legendFormat": "P95"
              },
              {
                "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket{job=&quot;machine-native-ops&quot;}[5m]))",
                "legendFormat": "P50"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "title": "Error Rate",
            "targets": [
              {
                "expr": "rate(http_requests_total{job=&quot;machine-native-ops&quot;,status=~&quot;5..&quot;}[5m]) / rate(http_requests_total{job=&quot;machine-native-ops&quot;}[5m])",
                "legendFormat": "Error Rate"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "title": "CPU Usage",
            "targets": [
              {
                "expr": "rate(container_cpu_usage_seconds_total{namespace=&quot;production&quot;,container=&quot;app&quot;}[5m])",
                "legendFormat": "{{ pod }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          },
          {
            "title": "Memory Usage",
            "targets": [
              {
                "expr": "container_memory_usage_bytes{namespace=&quot;production&quot;,container=&quot;app&quot;} / 1024 / 1024",
                "legendFormat": "{{ pod }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
          },
          {
            "title": "Active Pods",
            "targets": [
              {
                "expr": "count(kube_pod_status_phase{namespace=&quot;production&quot;,phase=&quot;Running&quot;})",
                "legendFormat": "Running"
              }
            ],
            "type": "stat",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
          }
        ]
      }
    }

  istio-mesh-dashboard.json: |
    {
      "dashboard": {
        "title": "Istio Mesh - Production",
        "uid": "istio-mesh-prod",
        "tags": ["istio", "production"],
        "timezone": "browser",
        "refresh": "30s",
        "panels": [
          {
            "title": "Request Volume",
            "targets": [
              {
                "expr": "sum(rate(istio_requests_total{destination_service_namespace=&quot;production&quot;}[5m])) by (destination_service)",
                "legendFormat": "{{ destination_service }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "title": "Success Rate",
            "targets": [
              {
                "expr": "sum(rate(istio_requests_total{destination_service_namespace=&quot;production&quot;,response_code!~&quot;5..&quot;}[5m])) / sum(rate(istio_requests_total{destination_service_namespace=&quot;production&quot;}[5m]))",
                "legendFormat": "Success Rate"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "title": "Latency",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, sum(rate(istio_request_duration_milliseconds_bucket{destination_service_namespace=&quot;production&quot;}[5m])) by (le, destination_service))",
                "legendFormat": "{{ destination_service }} - P95"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "title": "Circuit Breaker Status",
            "targets": [
              {
                "expr": "sum(istio_circuit_breakers_open{destination_service_namespace=&quot;production&quot;}) by (destination_service)",
                "legendFormat": "{{ destination_service }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          }
        ]
      }
    }

  backup-status-dashboard.json: |
    {
      "dashboard": {
        "title": "Backup Status - Production",
        "uid": "backup-status-prod",
        "tags": ["backup", "production"],
        "timezone": "browser",
        "refresh": "5m",
        "panels": [
          {
            "title": "Last Backup Time",
            "targets": [
              {
                "expr": "velero_backup_last_success_timestamp{namespace=&quot;velero&quot;}",
                "legendFormat": "{{ schedule }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "title": "Backup Duration",
            "targets": [
              {
                "expr": "velero_backup_duration_seconds{namespace=&quot;velero&quot;}",
                "legendFormat": "{{ name }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "title": "Backup Size",
            "targets": [
              {
                "expr": "velero_backup_volume_size_bytes{namespace=&quot;velero&quot;} / 1024 / 1024 / 1024",
                "legendFormat": "{{ name }}"
              }
            ],
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "title": "Backup Status",
            "targets": [
              {
                "expr": "velero_backup_status{namespace=&quot;velero&quot;}",
                "legendFormat": "{{ name }}"
              }
            ],
            "type": "stat",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          }
        ]
      }
    }