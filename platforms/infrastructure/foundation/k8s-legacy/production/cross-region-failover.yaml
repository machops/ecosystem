---
apiVersion: v1
data:
  failover-automation.yaml: "# Cross-region failover automation\nfailoverAutomation:\n\
    \  enabled: true\n  \n  # Failover triggers\n  triggers:\n    - name: regional-outage\n\
    \      type: regional\n      enabled: true\n      conditions:\n        unhealthyZones:\
    \ 2\n        unhealthyDuration: 5m\n        verificationChecks: 3\n      actions:\n\
    \        - type: redirect-traffic\n          targetRegion: us-west-2\n       \
    \ - type: scale-up\n          targetRegion: us-west-2\n          replicas: 9\n\
    \        - type: promote-database\n          targetRegion: us-west-2\n      notification:\n\
    \        channels:\n          - slack\n          - pagerduty\n          - email\n\
    \        message: \"Regional outage detected - initiating failover to us-west-2\"\
    \n    \n    - name: database-failure\n      type: database\n      enabled: true\n\
    \      conditions:\n        primaryUnhealthy: true\n        standbyHealthy: true\n\
    \        replicationLag: 10s\n      actions:\n        - type: promote-standby\n\
    \          targetRegion: us-west-2\n        - type: update-dns\n          newPrimary:\
    \ us-west-2\n        - type: notify-applications\n      notification:\n      \
    \  channels:\n          - slack\n          - pagerduty\n        message: \"Database\
    \ failure detected - promoting standby database\"\n    \n    - name: performance-degradation\n\
    \      type: performance\n      enabled: true\n      conditions:\n        latencyThreshold:\
    \ 1000ms\n        errorRateThreshold: 10\n        duration: 10m\n      actions:\n\
    \        - type: redistribute-traffic\n          primaryWeight: 40\n         \
    \ drWeight: 60\n      notification:\n        channels:\n          - slack\n  \
    \      message: \"Performance degradation detected - redistributing traffic\"\n\
    \    \n    - name: manual-failover\n      type: manual\n      enabled: true\n\
    \      requiresApproval: true\n      approvalTimeout: 30m\n      actions:\n  \
    \      - type: redirect-traffic\n          targetRegion: us-west-2\n        -\
    \ type: promote-database\n          targetRegion: us-west-2\n        - type: scale-up\n\
    \          targetRegion: us-west-2\n      notification:\n        channels:\n \
    \         - slack\n          - email\n        message: \"Manual failover initiated\
    \ by {user}\"\n  \n  # Failover workflow\n  workflow:\n    steps:\n      - name:\
    \ pre-failover-checks\n        actions:\n          - verify-target-region-health\n\
    \          - verify-database-replication-status\n          - verify-dns-health-checks\n\
    \          - verify-capacity-in-target\n        timeout: 2m\n        onFail: abort\n\
    \    \n      - name: initiate-failover\n        actions:\n          - scale-up-target-region\n\
    \          - promote-standby-database\n          - verify-database-promotion\n\
    \        timeout: 5m\n        onFail: rollback\n    \n      - name: update-dns\n\
    \        actions:\n          - update-dns-records\n          - verify-dns-propagation\n\
    \          - verify-health-checks\n        timeout: 10m\n        onFail: rollback\n\
    \    \n      - name: verify-failover\n        actions:\n          - verify-traffic-redirect\n\
    \          - verify-application-health\n          - verify-database-connectivity\n\
    \          - verify-critical-services\n        timeout: 5m\n        onFail: rollback\n\
    \    \n      - name: post-failover\n        actions:\n          - send-notifications\n\
    \          - update-monitoring\n          - create-incident-report\n         \
    \ - schedule-failback-review\n        timeout: 2m\n    \n    rollback:\n     \
    \ enabled: true\n      triggers:\n        - failover-failed\n        - verification-failed\n\
    \        - target-region-unhealthy\n      steps:\n        - revert-dns-changes\n\
    \        - demote-promoted-database\n        - scale-down-target-region\n    \
    \    - verify-rollback\n  \n  # Failover cooldown\n  cooldown:\n    enabled: true\n\
    \    duration: 5m\n    maxFailoversPerHour: 1\n    maxFailoversPerDay: 3\n  \n\
    \  # Failback configuration\n  failback:\n    enabled: true\n    mode: manual\n\
    \    prerequisites:\n      - source-region-healthy: true\n      - minimum-duration:\
    \ 4h\n      - manual-approval: true\n      - business-hours-only: false\n    notification:\n\
    \      before: 2h\n      channels:\n        - slack\n        - email\n    workflow:\n\
    \      steps:\n        - verify-source-region-health\n        - initiate-traffic-shift\n\
    \        - verify-source-readiness\n        - promote-source-database\n      \
    \  - update-dns\n        - verify-failback\n  \n  # Monitoring and metrics\n \
    \ monitoring:\n    enabled: true\n    metrics:\n      failoverCount:\n       \
    \ enabled: true\n        alerting:\n          threshold: 5\n          period:\
    \ 24h\n      failoverDuration:\n        enabled: true\n        target: <300s\n\
    \      failbackDuration:\n        enabled: true\n        target: <600s\n     \
    \ rto:\n        enabled: true\n        target: <4h\n      rpo:\n        enabled:\
    \ true\n        target: <1h"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/cross-region-failover-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:cross-region-failover-config:sha256-78d403d517372b2c1428844a382c8667e17378620a06a2f31f6a7a9476cce9e3
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: cross-region-failover-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: cross-region-failover-config
  namespace: production
