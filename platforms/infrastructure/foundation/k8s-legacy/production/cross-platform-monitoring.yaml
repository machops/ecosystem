---
apiVersion: v1
kind: ConfigMap
---
data:
  azure-monitor.yaml: "azure-monitor:\n  enabled: ${AZURE_MONITOR_ENABLED:-false}\n\
    \  instrumentationKey: ${AZURE_APP_INSIGHTS_KEY}\n  resourceGroup: ${RESOURCE_GROUP}\n\
    \  subscriptionId: ${SUBSCRIPTION_ID}\n  \n  metrics:\n    # Application Metrics\n\
    \    - name: requests/count\n      aggregation: [count, avg, sum]\n    \n    -\
    \ name: requests/duration\n      aggregation: [avg, min, max]\n    \n    - name:\
    \ exceptions/count\n      aggregation: [count, sum]\n    \n    - name: performanceCounters/availableMemory\n\
    \      aggregation: [avg, min, max]\n    \n    - name: performanceCounters/processCpuPercentage\n\
    \      aggregation: [avg, min, max]\n  \n  logs:\n    logType: ApplicationInsights\n\
    \    samplingPercentage: 100\n"
  cloudwatch.yaml: "cloudwatch:\n  enabled: ${CLOUDWATCH_ENABLED:-false}\n  region:\
    \ ${AWS_REGION:-us-east-1}\n  namespace: MachineNativeOps/Production\n  \n  metrics:\n\
    \    # Application Metrics\n    - name: RequestCount\n      unit: Count\n    \
    \  statistics: [Sum, SampleCount]\n      dimensions:\n        - name: Service\n\
    \          value: machine-native-ops\n    \n    - name: RequestLatency\n     \
    \ unit: Milliseconds\n      statistics: [Average, Minimum, Maximum, p95, p99]\n\
    \      dimensions:\n        - name: Service\n          value: machine-native-ops\n\
    \        - name: Operation\n          value: ${OPERATION}\n    \n    - name: ErrorRate\n\
    \      unit: Percent\n      statistics: [Average]\n      dimensions:\n       \
    \ - name: Service\n          value: machine-native-ops\n    \n    - name: ActiveConnections\n\
    \      unit: Count\n      statistics: [Average, Maximum]\n      dimensions:\n\
    \        - name: Service\n          value: machine-native-ops\n        - name:\
    \ Type\n          value: database\n    \n    # Infrastructure Metrics\n    - name:\
    \ CPUUtilization\n      unit: Percent\n      statistics: [Average, Maximum]\n\
    \      dimensions:\n        - name: Service\n          value: machine-native-ops\n\
    \    \n    - name: MemoryUtilization\n      unit: Percent\n      statistics: [Average,\
    \ Maximum]\n      dimensions:\n        - name: Service\n          value: machine-native-ops\n\
    \    \n    - name: DiskIOPS\n      unit: Count/Second\n      statistics: [Average]\n\
    \      dimensions:\n        - name: Service\n          value: machine-native-ops\n\
    \  \n  logs:\n    logGroup: /aws/eks/${CLUSTER_NAME}/machine-native-ops\n    logStreamPrefix:\
    \ application\n    retentionInDays: 30\n"
  gcp-monitoring.yaml: "gcp-monitoring:\n  enabled: ${GCP_MONITORING_ENABLED:-false}\n\
    \  project: ${GCP_PROJECT}\n  \n  metrics:\n    # Custom Metrics\n    - name:\
    \ custom.googleapis.com/machine-native-ops/request_count\n      type: GAUGE\n\
    \      metricKind: CUMULATIVE\n      valueType: INT64\n      unit: 1\n      labels:\n\
    \        eco-base/part-of: eco-base\n        eco-base/governance: aligned\n  \
    \      - name: operation\n          type: STRING\n        - name: status\n   \
    \       type: STRING\n    \n    - name: custom.googleapis.com/machine-native-ops/request_latency\n\
    \      type: GAUGE\n      metricKind: GAUGE\n      valueType: DOUBLE\n      unit:\
    \ ms\n      labels:\n        eco-base/part-of: eco-base\n        eco-base/governance:\
    \ aligned\n        - name: operation\n          type: STRING\n        - name:\
    \ percentile\n          type: STRING\n    \n    - name: custom.googleapis.com/machine-native-ops/error_rate\n\
    \      type: GAUGE\n      metricKind: GAUGE\n      valueType: DOUBLE\n      unit:\
    \ 1\n      labels:\n        eco-base/part-of: eco-base\n        eco-base/governance:\
    \ aligned\n        - name: error_type\n          type: STRING\n  \n  logs:\n \
    \   logId: machine-native-ops-production\n    resource:\n      type: k8s_container\n\
    \      labels:\n        eco-base/part-of: eco-base\n        eco-base/governance:\
    \ aligned\n        cluster_name: ${CLUSTER_NAME}\n        location: ${GCP_ZONE}\n\
    \        namespace_name: production\n        pod_name: ${POD_NAME}\n        container_name:\
    \ machine-native-ops\n"
  grafana-dashboards.yaml: 'apiVersion: v1

    kind: ConfigMap

    '
  opentelemetry.yaml: "receivers:\n  # Application Metrics\n  prometheus:\n    config:\n\
    \      scrape_configs:\n        - job_name: 'machine-native-ops'\n          scrape_interval:\
    \ 15s\n          metrics_path: /metrics\n          static_configs:\n         \
    \   - targets: ['localhost:9090']\n  \n  # Application Logs\n  otlp:\n    protocols:\n\
    \      grpc:\n        endpoint: 0.0.0.0:4317\n      http:\n        endpoint: 0.0.0.0:4318\n\
    \  \n  # Application Traces\n  jaeger:\n    protocols:\n      grpc:\n        endpoint:\
    \ 0.0.0.0:14250\n      thrift_http:\n        endpoint: 0.0.0.0:14268\n      thrift_compact:\n\
    \        endpoint: 0.0.0.0:6831\n\nprocessors:\n  batch:\n    timeout: 5s\n  \
    \  send_batch_size: 10000\n  memory_limiter:\n    limit_mib: 512\n    spike_limit_mib:\
    \ 100\n    check_interval: 5s\n  attributes:\n    actions:\n      - key: environment\n\
    \        value: production\n        action: upsert\n      - key: service.name\n\
    \        value: machine-native-ops\n        action: upsert\n\nexporters:\n  #\
    \ Prometheus Exporter\n  prometheusremotewrite:\n    endpoint: ${PROMETHEUS_REMOTE_WRITE_URL}\n\
    \    headers:\n      X-Prometheus-Remote-Write-Version: \"0.1.0\"\n  \n  # AWS\
    \ CloudWatch Exporter\n  awscwlogs:\n    log_group_name: /machine-native-ops/production\n\
    \    log_stream_name: {instance}\n    region: ${AWS_REGION:-us-east-1}\n    log_retention:\
    \ 30\n  \n  # Google Cloud Monitoring Exporter\n  googlecloud:\n    project: ${GCP_PROJECT}\n\
    \    log:\n      resource:\n        type: k8s_container\n    metric:\n      resource:\n\
    \        type: k8s_container\n  \n  # Azure Monitor Exporter\n  azuremonitor:\n\
    \    instrumentation_key: ${AZURE_APP_INSIGHTS_KEY}\n    max_batch_size: 1000\n\
    \    max_batch_interval: 10s\n  \n  # Jaeger Exporter\n  jaeger:\n    endpoint:\
    \ ${JAEGER_ENDPOINT:-http://jaeger-collector:14250}\n    tls:\n      insecure:\
    \ true\n  \n  # Loki Exporter\n  loki:\n    endpoint: ${LOKI_ENDPOINT:-http://loki:3100/loki/api/v1/push}\n\
    \    labels:\n      eco-base/part-of: eco-base\n      eco-base/governance: aligned\n\
    \      environment: production\n      service: machine-native-ops\n  \n  # Elasticsearch\
    \ Exporter\n  elasticsearch:\n    endpoints: [${ES_ENDPOINT:-http://elasticsearch:9200}]\n\
    \    index: machine-native-ops-${date:2006-01-02}\n    flush_interval: 1s\n\n\
    service:\n  pipelines:\n    # Metrics Pipeline\n    metrics:\n      receivers:\
    \ [prometheus]\n      processors: [batch, memory_limiter]\n      exporters: [prometheusremotewrite,\
    \ googlecloud, azuremonitor]\n    \n    # Logs Pipeline\n    logs:\n      receivers:\
    \ [otlp]\n      processors: [batch, memory_limiter, attributes]\n      exporters:\
    \ [awscwlogs, googlecloud, loki, elasticsearch]\n    \n    # Traces Pipeline\n\
    \    traces:\n      receivers: [jaeger, otlp]\n      processors: [batch, memory_limiter,\
    \ attributes]\n      exporters: [jaeger, googlecloud, azuremonitor]\n"
  prometheus.yaml: "global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\
    \  external_labels:\n    eco-base/part-of: eco-base\n    eco-base/governance:\
    \ aligned\n    cluster: ${CLUSTER_NAME}\n    environment: production\n\nscrape_configs:\n\
    \  - job_name: 'machine-native-ops'\n    kubernetes_sd_configs:\n      - role:\
    \ pod\n        namespaces:\n          names:\n            - production\n    relabel_configs:\n\
    \      - source_labels:\n        eco-base/part-of: eco-base\n        eco-base/governance:\
    \ aligned\n        action: keep\n        regex: machine-native-ops\n      - source_labels:\n\
    \        eco-base/part-of: eco-base\n        eco-base/governance: aligned\n  \
    \      target_label: pod\n      - source_labels:\n        eco-base/part-of: eco-base\n\
    \        eco-base/governance: aligned\n        target_label: namespace\n     \
    \ - source_labels:\n        eco-base/part-of: eco-base\n        eco-base/governance:\
    \ aligned\n        target_label: node\n  \n  - job_name: 'kubernetes-pods'\n \
    \   kubernetes_sd_configs:\n      - role: pod\n    relabel_configs:\n      - source_labels:\n\
    \        eco-base/part-of: eco-base\n        eco-base/governance: aligned\n  \
    \      action: keep\n        regex: true\n      - source_labels:\n        eco-base/part-of:\
    \ eco-base\n        eco-base/governance: aligned\n        action: replace\n  \
    \      target_label: __metrics_path__\n        regex: (.+)\n      - source_labels:\n\
    \        eco-base/part-of: eco-base\n        eco-base/governance: aligned\n  \
    \      action: replace\n        regex: ([^:]+)(?::\\d+)?;(\\d+)\n        replacement:\
    \ $1:$2\n        target_label: __address__\n      - action: labelmap\n       \
    \ regex: __meta_kubernetes_pod_label_(.+)\n      - source_labels:\n        eco-base/part-of:\
    \ eco-base\n        eco-base/governance: aligned\n        action: replace\n  \
    \      target_label: namespace\n      - source_labels:\n        eco-base/part-of:\
    \ eco-base\n        eco-base/governance: aligned\n        action: replace\n  \
    \      target_label: pod\n\nremote_write:\n  - url: ${PROMETHEUS_REMOTE_WRITE_URL}\n\
    \    queue_config:\n      capacity: 10000\n      max_shards: 50\n      min_shards:\
    \ 1\n      max_samples_per_send: 5000\n      batch_send_deadline: 5s\n      min_backoff:\
    \ 30ms\n      max_backoff: 100ms\n"
metadata:
  name: cross-platform-monitoring-config
  namespace: production
---
apiVersion: v1
data:
  machine-native-ops-dashboard.json: '{

    "dashboard": {

    "title": "MachineNativeOps - Cross-Platform Monitoring",

    "panels": [

    {

    "title": "Request Rate",

    "targets": [

    {

    "expr": "sum(rate(http_requests_total{service=&quot;machine-native-ops&quot;}[5m]))",

    "legendFormat": "{{method}} {{path}}"

    }

    ],

    "type": "graph"

    },

    {

    "title": "Request Latency",

    "targets": [

    {

    "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{service=&quot;machine-native-ops&quot;}[5m]))
    by (le))",

    "legendFormat": "P95"

    },

    {

    "expr": "histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{service=&quot;machine-native-ops&quot;}[5m]))
    by (le))",

    "legendFormat": "P99"

    }

    ],

    "type": "graph"

    },

    {

    "title": "Error Rate",

    "targets": [

    {

    "expr": "sum(rate(http_requests_total{service=&quot;machine-native-ops&quot;,status=~&quot;5..&quot;}[5m]))
    / sum(rate(http_requests_total{service=&quot;machine-native-ops&quot;}[5m])) *
    100",

    "legendFormat": "Error Rate %"

    }

    ],

    "type": "gauge"

    },

    {

    "title": "Active Connections",

    "targets": [

    {

    "expr": "active_connections{service=&quot;machine-native-ops&quot;}",

    "legendFormat": "{{type}}"

    }

    ],

    "type": "graph"

    },

    {

    "title": "CPU Utilization",

    "targets": [

    {

    "expr": "rate(process_cpu_seconds_total{service=&quot;machine-native-ops&quot;}[5m])
    * 100",

    "legendFormat": "CPU %"

    }

    ],

    "type": "graph"

    },

    {

    "title": "Memory Utilization",

    "targets": [

    {

    "expr": "process_resident_memory_bytes{service=&quot;machine-native-ops&quot;}
    / 1024 / 1024",

    "legendFormat": "Memory MB"

    }

    ],

    "type": "graph"

    }

    ]

    }

    }

    '
kind: ConfigMap
metadata:
  annotations:
    eco-base/uri: eco-base://k8s/core/configmap/grafana-dashboards
    eco-base/urn: urn:eco-base:k8s:core:configmap:grafana-dashboards:sha256-d2bd941e7d3eefdf32b7fa2a806a3c2d9c6eefa5abf3c46f3948862fa3a78ada
  labels: {}
  name: grafana-dashboards
  namespace: monitoring
