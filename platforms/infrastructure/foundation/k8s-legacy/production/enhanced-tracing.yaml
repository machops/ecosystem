---
apiVersion: v1
data:
  jaeger.yaml: "# Enhanced Jaeger configuration for production\nsampling:\n  # Adaptive\
    \ sampling configuration\n  defaultStrategy:\n    type: probabilistic\n    probabilistic:\n\
    \      samplingRate: 0.10  # 10% default sampling\n  # Service-specific sampling\n\
    \  serviceStrategies:\n    - service: machine-native-ops-production\n      type:\
    \ probabilistic\n      probabilistic:\n        samplingRate: 0.20  # 20% for main\
    \ service\n    - service: machine-native-ops-api\n      type: probabilistic\n\
    \      probabilistic:\n        samplingRate: 0.30  # 30% for API endpoints\n \
    \   - service: machine-native-ops-background\n      type: probabilistic\n    \
    \  probabilistic:\n        samplingRate: 0.05  # 5% for background jobs\n  # Operation-specific\
    \ sampling\n  operationStrategies:\n    - service: machine-native-ops-production\n\
    \      operation: /api/v1/health\n      type: probabilistic\n      probabilistic:\n\
    \        samplingRate: 0.01  # 1% for health checks\n    - service: machine-native-ops-production\n\
    \      operation: POST /api/v1/execute\n      type: probabilistic\n      probabilistic:\n\
    \        samplingRate: 0.50  # 50% for execution operations\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/jaeger-enhanced-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:jaeger-enhanced-config:sha256-334732f362c683602d897765b29976d14e5d97f8a947e9b8ec531a7e28005743
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: jaeger-enhanced-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: jaeger-enhanced-config
  namespace: istio-system
---
apiVersion: v1
data:
  context-propagation.yaml: "# Context propagation configuration\npropagators:\n \
    \ - jaeger\n  - b3\n  - trace-context\n  - w3c\n  - xray\n# Baggage propagation\n\
    baggage:\n  enabled: true\n  maxKeyValuePairs: 32\n  maxValueLength: 4096\n# Trace\
    \ ID propagation\ntraceId:\n  generation:\n    strategy: random\n    format: uuid4\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/tracing-context-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:tracing-context-config:sha256-39bdb566093b4f19319a66c897cd23726bf33364098e77499df5b64e47a7b396
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: tracing-context-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: tracing-context-config
  namespace: istio-system
---
apiVersion: v1
data:
  retention-policy.yaml: "# Trace retention configuration\nretention:\n  default:\n\
    \    days: 30  # Default retention: 30 days\n  byService:\n    machine-native-ops-production:\n\
    \      days: 90  # Main service: 90 days\n    machine-native-ops-api:\n      days:\
    \ 60  # API: 60 days\n    machine-native-ops-background:\n      days: 30  # Background:\
    \ 30 days\n  byOperation:\n    health-check:\n      days: 7   # Health checks:\
    \ 7 days\n    execution:\n      days: 90  # Executions: 90 days\n    cache-operations:\n\
    \      days: 30  # Cache ops: 30 days\n  archive:\n    enabled: true\n    format:\
    \ json\n    compression: gzip\n    storage: s3\n    destination: s3://traces-archive/\n\
    # Trace cleanup configuration\ncleanup:\n  enabled: true\n  schedule: \"0 2 *\
    \ * *\"  # Daily at 2 AM\n  batchSize: 10000\n  maxAge: 90\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/trace-retention-config
    eco-base/urn: urn:eco-base:k8s:core:configmap:trace-retention-config:sha256-2fc9879939042179f5b6f19e0d763ee5d512b5ba1a0ced8816f738e65c498762
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: trace-retention-config
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: trace-retention-config
  namespace: istio-system
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  annotations:
    eco-base/uri: eco-base://platform/resource/infrastructure/foundation/k8s-legacy/production/enhanced-tracing.yaml
    eco-base/urn: urn:eco-base:platform:resource:infrastructure:foundation:k8s-legacy:production:enhanced-tracing.yaml
  name: enhanced-tracing
  namespace: istio-system
spec:
  accessLogging:
  - filter:
      expression: request.headers["x-b3-traceid"] != ""
    providers:
    - name: envoy
  tracing:
  - customTags:
      cluster_id:
        environment:
          name: ISTIO_META_CLUSTER_ID
      deployment_id:
        environment:
          name: ISTIO_METADATA_DEPLOYMENT_ID
      node_name:
        environment:
          name: ISTIO_META_NODE_NAME
      operation_name:
        environment:
          name: ISTIO_METADATA_OPERATION_NAME
      request_id:
        environment:
          name: ISTIO_METADATA_REQUEST_ID
      service_version:
        environment:
          name: ISTIO_METADATA_VERSION
      session_id:
        environment:
          name: ISTIO_METADATA_SESSION_ID
      user_id:
        environment:
          name: ISTIO_METADATA_USER_ID
      zone:
        environment:
          name: ISTIO_META_ZONE
    providers:
    - name: jaeger
    randomSamplingPercentage: 10.0
