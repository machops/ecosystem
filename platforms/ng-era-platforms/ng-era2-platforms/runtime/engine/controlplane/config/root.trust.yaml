---
apiVersion: machinenativeops.io/v1
kind: RootTrustConfig
metadata:
  annotations:
    machinenativeops.io/description: Root layer trust, certificates and security configuration
    machinenativeops.io/last-modified: '2025-12-20T22:00:00Z'
  labels:
    eco-base/governance: aligned
    eco-base/part-of: eco-base
    machinenativeops.io/component: trust-configuration
    machinenativeops.io/tier: trust
    machinenativeops.io/version: v1.0.0
  name: trust-baseline-config
  namespace: machinenativenops-trust
spec:
  attestation_bundles:
  - attesters:
    - measurement_type: pcr
      name: tpm-attester
      required_measurements:
      - 0
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
      - 7
      type: hardware
    - name: secure-boot-attester
      type: firmware
      verification_method: uefi_secure_boot
    - algorithm: sha256
      measurement_type: disk_hash
      name: disk-attester
      type: disk
    bundle_type: boot_integrity
    description: System boot integrity attestation
    evidence_collection:
    - boot_loader_hash
    - kernel_hash
    - initramfs_hash
    - critical_config_hash
    name: system-boot-attestation
    required_for: system_startup
    validation_policy:
    - 'measurements_match_baseline: true'
    - 'signature_valid: true'
    - 'timestamp_within_window: 24h'
    version: '1.0'
  - attesters:
    - name: build-system-attester
      type: build
      verification_method: build_pipeline_signature
    - name: repository-attester
      type: repository
      verification_method: git_commit_signature
    - name: container-attester
      type: container
      verification_method: image_signature
    bundle_type: deployment_integrity
    description: Module deployment integrity attestation
    evidence_collection:
    - source_code_hash
    - build_artifact_hash
    - container_image_hash
    - deployment_config_hash
    name: module-deployment-attestation
    required_for: module_deployment
    validation_policy:
    - 'all_signatures_valid: true'
    - 'hashes_match_expected: true'
    - 'approval_chain_complete: true'
    version: '1.0'
  - attesters:
    - name: config-author-attester
      type: human
      verification_method: digital_signature
    - name: reviewer-attester
      type: human
      verification_method: approval_signature
    - name: system-attester
      type: automated
      verification_method: system_signature
    bundle_type: config_integrity
    description: Configuration change attestation
    evidence_collection:
    - config_before_hash
    - config_after_hash
    - change_request_id
    - approval_chain_signatures
    name: configuration-change-attestation
    required_for: configuration_change
    validation_policy:
    - 'required_approvals_present: true'
    - 'signature_chain_valid: true'
    - 'change_authorized: true'
    version: '1.0'
  certificate_authorities:
  - ca_certificate: intermediate-ca-01
    description: Internal system certificate authority
    issuing_policy:
    - allowed_subjects:
      - '*.machinenativenops.local'
      - '*.svc.cluster.local'
      certificate_type: server
      extended_key_usage:
      - serverAuth
      - clientAuth
      key_usage:
      - digitalSignature
      - keyEncipherment
      max_validity: 1y
    - allowed_subjects:
      - '*.machinenativenops.local'
      - system-.*
      certificate_type: client
      extended_key_usage:
      - clientAuth
      key_usage:
      - digitalSignature
      max_validity: 1y
    - allowed_subjects:
      - machinenativenops-*
      certificate_type: code_signing
      extended_key_usage:
      - codeSigning
      key_usage:
      - digitalSignature
      max_validity: 6m
    name: system-ca
    revocation:
      crl_url: http://crl.machinenativenops.local/crl.crl
      method: ocsp
      ocsp_url: http://ocsp.machinenativenops.local:8080
      update_interval: 1h
    type: internal
  - ca_certificate: intermediate-ca-02
    description: External certificate authority for third-party integrations
    name: external-ca
    trusted_external_cas:
    - certificate_path: /etc/machinenativenops/trust/external/letsencrypt-r3.pem
      name: letsencrypt-r3
      purpose: server_authentication
    - certificate_path: /etc/machinenativenops/trust/external/digicert-global-ca.pem
      name: digicert-global-ca
      purpose: server_authentication
    - certificate_path: /etc/machinenativenops/trust/external/amazon-root-ca-1.pem
      name: amazon-root-ca-1
      purpose: server_authentication
    type: external
  key_management:
  - access_policy:
    - 'key_usage: key_cert_sign, crl_sign'
    - 'access_time: business_hours_only'
    - 'mfa_required: true'
    - 'approval_required: true'
    - 'audit_required: true'
    description: Root CA private key
    key_size: 4096
    key_type: rsa
    name: root-ca-key
    rotation:
      emergency_rotation: true
      enabled: false
    storage:
      backup_hsm: backup_hsm
      hsm_name: primary_hsm
      key_id: root_ca_key
      type: hsm
  - access_policy:
    - 'key_usage: key_cert_sign, crl_sign'
    - 'access_time: any_time'
    - 'mfa_required: true'
    - 'approval_required: false'
    - 'audit_required: true'
    description: Intermediate CA private key
    key_size: 4096
    key_type: rsa
    name: intermediate-ca-key
    rotation:
      enabled: true
      overlap_period: 3m
      rotation_period: 4y
    storage:
      backup_location: /secure/backup/intermediate_ca.key.enc
      hsm_name: primary_hsm
      key_id: intermediate_ca_key
      type: hsm
  - access_policy:
    - 'key_usage: digital_signature'
    - 'access_time: build_hours_only'
    - 'mfa_required: true'
    - 'approval_required: false'
    - 'audit_required: true'
    curve: P-384
    description: System code signing key
    key_type: ecdsa
    name: system-signing-key
    rotation:
      enabled: true
      overlap_period: 1m
      rotation_period: 1y
    storage:
      hsm_name: primary_hsm
      key_id: system_signing_key
      type: hsm
  security_policies:
  - description: Certificate issuance and management policies
    issuance_rules:
    - 'minimum_key_size_rsa: 2048'
    - 'minimum_key_size_ecdsa: 256'
    - 'allowed_signature_algorithms: [SHA256withRSA, SHA384withRSA, SHA512withRSA,
      ECDSAwithSHA256, ECDSAwithSHA384, ECDSAwithSHA512]'
    - 'forbidden_signature_algorithms: [SHA1withRSA, MD5withRSA]'
    - 'maximum_validity_period_server: 1y'
    - 'maximum_validity_period_client: 1y'
    - 'maximum_validity_period_code_signing: 6m'
    name: certificate-policy
    renewal_rules:
    - 'renewal_start_period: 30d_before_expiry'
    - 'renewal_reminder_period: 7d_before_expiry'
    - 'auto_renewal_enabled: true'
    - 'manual_approval_required: false'
  - description: Key usage and protection policies
    name: key-usage-policy
    protection_rules:
    - 'hsm_protection_required: true'
    - 'mfa_access_required: true'
    - 'audit_access_required: true'
    - 'dual_control_required: true'
    usage_rules:
    - 'private_key_export_prohibited: true'
    - 'key_derivation_allowed: false'
    - 'key_backup_required: true'
    - 'key_escrow_enabled: false'
    - 'session_key_derivation: true'
  trust_chain_validation:
  - crl_validation:
      distribution_points:
      - http://crl.machinenativenops.local/crl.crl
      enabled: true
      update_interval: 1h
    description: Validate certificate chains against trust roots
    enabled: true
    name: certificate-chain-validation
    ocsp_validation:
      enabled: true
      fallback_to_crl: true
      timeout: 10s
    validation_rules:
    - 'certificate_chain_length: <= 5'
    - 'intermediate_ca_count: <= 3'
    - 'root_ca_trusted: true'
    - 'signature_algorithm_valid: true'
    - 'key_usage_appropriate: true'
    - 'extended_key_usage_valid: true'
    - 'certificate_not_expired: true'
    - 'certificate_not_revoked: true'
  - description: Validate trust paths for specific use cases
    enabled: true
    name: path-validation
    validation_profiles:
    - max_path_length: 3
      name: server-authentication
      require_ocsp_stapling: true
      required_ekus:
      - serverAuth
    - max_path_length: 2
      name: client-authentication
      require_ocsp_stapling: false
      required_ekus:
      - clientAuth
    - max_path_length: 3
      name: code-signing
      require_timestamp: true
      required_ekus:
      - codeSigning
  trust_roots:
  - auto_rotation: false
    backup_required: true
    certificate_id: mno-root-ca-001
    description: System root certificate authority
    key_algorithm: RSA-4096
    name: system-root-ca
    public_key_path: /etc/machinenativenops/trust/roots/system-root-ca.pem
    recovery_procedures:
    - offline_backup_restoration
    - emergency_reissuance
    signature_algorithm: SHA256withRSA
    status: active
    type: root_ca
    validity_period: 10y
  - auto_rotation: true
    backup_required: true
    certificate_id: mno-intermediate-ca-001
    description: Intermediate certificate authority for system components
    key_algorithm: RSA-4096
    name: intermediate-ca-01
    parent_ca: system-root-ca
    private_key_path: /etc/machinenativenops/trust/keys/intermediate-ca-01.key
    public_key_path: /etc/machinenativenops/trust/roots/intermediate-ca-01.pem
    rotation_period: 4y
    signature_algorithm: SHA256withRSA
    status: active
    type: intermediate_ca
    validity_period: 5y
  - auto_rotation: true
    backup_required: true
    certificate_id: mno-intermediate-ca-002
    description: Intermediate certificate authority for external entities
    key_algorithm: RSA-4096
    name: intermediate-ca-02
    parent_ca: system-root-ca
    private_key_path: /etc/machinenativenops/trust/keys/intermediate-ca-02.key
    public_key_path: /etc/machinenativenops/trust/roots/intermediate-ca-02.pem
    rotation_period: 4y
    signature_algorithm: SHA256withRSA
    status: active
    type: intermediate_ca
    validity_period: 5y
  verification_policies:
  - description: Strict TLS verification policy for internal communications
    enabled: true
    exceptions:
    - approval_required: true
      override_value: false
      requirement: mutual_tls_required
      scenario: emergency_recovery
    name: strict-tls-verification
    requirements:
    - 'mutual_tls_required: true'
    - 'certificate_validation: strict'
    - 'hostname_verification: true'
    - 'certificate_chain_validation: true'
    - 'ocsp_stapling: true'
    scope:
    - internal_services
    - database_connections
    - message_queues
  - description: Code signing verification policy
    enabled: true
    name: code-signing-verification
    requirements:
    - 'signature_verification: required'
    - 'certificate_trust: system-ca'
    - 'timestamp_verification: true'
    - 'hash_verification: sha256'
    scope:
    - executable_files
    - python_modules
    - container_images
    - configuration_files
    trusted_signers:
    - system-code-signer
    - official-build-system
  - description: Data integrity verification policy
    enabled: true
    name: data-integrity-verification
    requirements:
    - 'digital_signature: required'
    - 'hash_verification: sha256'
    - 'merkle_tree_verification: true'
    - 'timestamp_verification: true'
    scope:
    - configuration_files
    - audit_logs
    - backup_files
    - migration_data
    verification_frequency: on_access
status:
  conditions:
  - lastTransitionTime: '2025-12-20T22:00:00Z'
    message: All trust roots established and operational
    reason: TrustRootsConfigured
    status: 'True'
    type: TrustRootsEstablished
  - lastTransitionTime: '2025-12-20T22:00:00Z'
    message: Certificate authorities are operational and issuing certificates
    reason: CAsReady
    status: 'True'
    type: CertificateAuthoritiesOperational
  - lastTransitionTime: '2025-12-20T22:00:00Z'
    message: All verification policies are active and enforced
    reason: PoliciesEnabled
    status: 'True'
    type: VerificationPoliciesActive
  phase: Active
---
apiVersion: v1
data:
  schema.yaml: "# Root Trust Configuration Schema\ntype: object\nproperties:\n  trust_roots:\n\
    \    type: array\n    items:\n      type: object\n      properties:\n        name:\n\
    \          type: string\n        description:\n          type: string\n      \
    \  type:\n          type: string\n          enum: [\"root_ca\", \"intermediate_ca\"\
    ]\n        status:\n          type: string\n          enum: [\"active\", \"inactive\"\
    , \"revoked\"]\n        certificate_id:\n          type: string\n        key_algorithm:\n\
    \          type: string\n        signature_algorithm:\n          type: string\n\
    \        validity_period:\n          type: string\n        auto_rotation:\n  \
    \        type: boolean\n      required: [\"name\", \"description\", \"type\",\
    \ \"status\", \"certificate_id\", \"key_algorithm\", \"signature_algorithm\"]\n\
    \  certificate_authorities:\n    type: array\n    items:\n      type: object\n\
    \      properties:\n        name:\n          type: string\n        description:\n\
    \          type: string\n        type:\n          type: string\n          enum:\
    \ [\"internal\", \"external\"]\n        ca_certificate:\n          type: string\n\
    \        issuing_policy:\n          type: array\n        revocation:\n       \
    \   type: object\n      required: [\"name\", \"description\", \"type\", \"ca_certificate\"\
    ]\n  verification_policies:\n    type: array\n    items:\n      type: object\n\
    \      properties:\n        name:\n          type: string\n        description:\n\
    \          type: string\n        enabled:\n          type: boolean\n        scope:\n\
    \          type: array\n        requirements:\n          type: object\n      required:\
    \ [\"name\", \"description\", \"enabled\", \"scope\", \"requirements\"]\nrequired:\
    \ [\"trust_roots\", \"certificate_authorities\", \"verification_policies\"]"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/trust-schema
    eco-base/urn: urn:eco-base:k8s:core:configmap:trust-schema:sha256-e3ac61c992e05676f11eb0c57387e471c72bc15efc837b917c3b80e19fd81ad3
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: trust-schema
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: trust-schema
  namespace: machinenativenops-trust
