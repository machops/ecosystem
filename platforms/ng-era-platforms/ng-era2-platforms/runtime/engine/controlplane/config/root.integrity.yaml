---
apiVersion: machinenativeops.io/v1
kind: RootIntegrityConfig
metadata:
  annotations:
    machinenativeops.io/description: Root layer integrity verification and validation
      rules configuration
    machinenativeops.io/last-modified: '2025-12-20T22:00:00Z'
  labels:
    eco-base/governance: aligned
    eco-base/part-of: eco-base
    machinenativeops.io/component: integrity-configuration
    machinenativeops.io/tier: integrity
    machinenativeops.io/version: v1.0.0
  name: integrity-baseline-config
  namespace: machinenativenops-integrity
spec:
  compliance_verification:
  - compliance_controls:
    - access_control_verification
    - change_management_audit
    - data_integrity_checks
    - segregation_of_duties
    - audit_trail_completeness
    description: Sarbanes-Oxley Act compliance verification
    enabled: true
    name: SOX_compliance
    reporting:
    - format: executive_summary
    - recipients:
      - compliance_officer
      - audit_committee
      - cto
    - retention: 7_years
    - archiving: compliance_storage
    verification_frequency: weekly
  - compliance_controls:
    - cardholder_data_protection
    - network_security_monitoring
    - access_control_verification
    - vulnerability_management
    - secure_coding_practices
    description: PCI DSS compliance verification
    enabled: true
    name: PCI_DSS_compliance
    reporting:
    - format: detailed_technical
    - recipients:
      - security_officer
      - pci_compliance_team
    - retention: 3_years
    - archiving: secure_archive
    verification_frequency: daily
  - compliance_controls:
    - information_security_policy
    - risk_assessment_process
    - asset_management
    - access_control
    - operations_security
    description: ISO 27001 compliance verification
    enabled: true
    name: ISO27001_compliance
    reporting:
    - format: comprehensive_report
    - recipients:
      - information_security_manager
      - management
    - retention: 3_years
    - archiving: compliance_archive
    verification_frequency: monthly
  drift_detection:
  - alerting:
      drift_detected:
        auto_remediation: false
        notification_channels:
        - configuration_team
        - operations_team
        severity: warning
      significant_drift:
        auto_remediation: true
        notification_channels:
        - all_teams
        - management
        remediation_action: rollback_to_baseline
        severity: critical
        threshold: 0.05
    check_frequency: hourly
    comparison_baseline: last_known_good_state
    description: Detect system configuration drift from baseline
    drift_threshold: 0.01
    enabled: true
    exclusion_patterns:
    - /tmp/**
    - /var/log/**
    - /var/cache/**
    - /proc/**
    - /sys/**
    monitored_attributes:
    - file_permissions
    - file_ownership
    - file_content_hash
    - directory_structure
    - symlink_targets
    - process_configuration
    name: system-configuration-drift
  - alerting:
      any_drift:
        auto_remediation: false
        immediate_action: investigation_required
        notification_channels:
        - security_team
        - incident_response
        severity: critical
    check_frequency: 30min
    comparison_baseline: security_baseline
    compliance_requirements:
    - SOX_section_404
    - PCI_DSS_requirement_1
    - ISO27001_A_9.1
    description: Detect security configuration drift
    drift_threshold: 0.0
    enabled: true
    monitored_attributes:
    - user_accounts
    - group_memberships
    - sudo_configurations
    - firewall_rules
    - ssl_certificates
    - access_control_lists
    name: security-configuration-drift
  freeze_policies:
  - description: Production environment freeze policy
    enabled: true
    exception_process:
    - 'emergency_approval_required: true'
    - 'approval_authority: cto'
    - 'documentation_required: true'
    - 'rollback_plan_required: true'
    - 'post_change_validation: true'
    frozen_operations:
    - configuration_changes
    - module_deployments
    - security_policy_modifications
    - user_account_changes
    - system_upgrades
    name: production-freeze
    notification:
      exception_granted:
      - all_stakeholders
      freeze_end:
      - all_stakeholders
      freeze_start:
      - all_stakeholders
    schedule:
    - end: '2025-12-21T07:00:00Z'
      recurring: daily
      start: '2025-12-20T23:00:00Z'
      type: maintenance_window
    - end: '2025-12-26T23:59:59Z'
      recurring: yearly
      start: '2025-12-24T00:00:00Z'
      type: holiday_period
  - auto_activation: true
    deactivation_conditions:
    - incident_resolved
    - vulnerabilities_mitigated
    - audit_completed
    description: Security-related freeze during incidents
    enabled: true
    exception_process:
    - security_team_approval_only
    - immediate_rollback_capability_required
    - enhanced_monitoring_required
    frozen_operations:
    - all_changes_except_security_patches
    - user_privilege_modifications
    - network_configuration_changes
    name: security-freeze
    trigger_conditions:
    - security_incident_declared
    - vulnerability_scan_high_risk
    - compliance_audit_in_progress
  hash_lock_rules:
  - baseline_storage:
      access_control: read_only
      backup_frequency: daily
      encryption: true
      type: secure_database
    description: Hash lock for critical system files
    enabled: true
    exceptions:
    - approval_required: true
      requirement: verification_before_update
      scenario: authorized_update
    file_patterns:
    - /etc/machinenativenops/**/*.yaml
    - /etc/machinenativenops/**/*.json
    - /opt/machinenativenops/modules/**/*.py
    - /usr/local/bin/machinenativenops-*
    hash_algorithm: SHA256
    name: critical-system-files
    scope: system_criticality
    verification_frequency: on_access
    violation_actions:
    - immediate_alert
    - file_quarantine
    - incident_creation
    - automatic_rollback_if_possible
  - baseline_storage:
      branch: main
      encryption: true
      git_repository: integrity-baselines
      type: version_control
    cross_validation:
    - governance_policy_compliance
    - trust_signature_verification
    description: Configuration file integrity verification
    enabled: true
    file_patterns:
    - .root.*.yaml
    - .github/workflows/*.yaml
    - config/**/*.yaml
    - config/**/*.json
    hash_algorithm: SHA256
    name: configuration-integrity
    scope: configuration
    verification_frequency: on_change
    violation_actions:
    - alert_configuration_team
    - prevent_deployment
    - require_manual_review
  - baseline_storage:
      hsm_name: integrity_hsm
      key_id: integrity_baseline_key
      type: hsm_protected
    code_signing_required: true
    description: Executable file integrity verification
    enabled: true
    file_patterns:
    - /opt/machinenativenops/modules/**/*
    - /usr/local/bin/machinenativenops-*
    - /usr/local/sbin/machinenativenops-*
    hash_algorithm: SHA256
    name: executable-integrity
    scope: security
    verification_frequency: on_execution
    violation_actions:
    - block_execution
    - security_incident
    - system_isolation
  integrity_metrics:
  - alerting:
      threshold_acceptable: 70
      threshold_critical: 50
      threshold_good: 85
    calculation_method: weighted_average
    components:
    - metric_source: hash_verification_results
      name: file_integrity
      weight: 0.3
    - metric_source: drift_detection_results
      name: configuration_integrity
      weight: 0.25
    - metric_source: security_policy_compliance
      name: security_integrity
      weight: 0.25
    - metric_source: system_health_monitoring
      name: operational_integrity
      weight: 0.2
    description: Overall system integrity score
    name: integrity_score
    scoring:
      acceptable: 70-84
      critical: 0-49
      excellent: 95-100
      good: 85-94
      poor: 50-69
  - alerting:
      critical_threshold: 5
      warning_threshold: 1
    calculation_method: absolute_percentage
    description: Percentage of configuration drift detected
    measurement_scope: all_monitored_assets
    name: drift_percentage
  - alerting:
      critical_threshold: 10
      warning_threshold: 5
    calculation_method: count_per_period
    description: Rate of integrity violations per day
    name: violation_rate
    period: 24h
  integrity_verification_workflows:
  - description: Establish integrity baseline for system
    enabled: true
    failure_actions:
    - retry_baseline_creation
    - notify_administrators
    - create_support_ticket
    name: baseline-establishment
    schedule: on_system_installation
    steps:
    - action: discover_critical_assets
      module: integrity-validator
      name: discover_critical_files
      parameters:
        exclude_patterns:
        - /tmp
        - /var/log
        - /var/cache
        file_patterns:
        - '*.yaml'
        - '*.json'
        - '*.py'
        - '*.sh'
        scan_directories:
        - /etc
        - /opt
        - /usr/local
      timeout: 300s
    - action: calculate_hashes
      module: integrity-validator
      name: calculate_file_hashes
      parameters:
        algorithm: SHA256
        include_metadata: true
        parallel_processing: true
      timeout: 600s
    - action: store_baseline
      module: integrity-validator
      name: store_baseline
      parameters:
        backup_enabled: true
        baseline_version: v1.0.0
        encryption: true
        storage_type: secure_database
      timeout: 120s
    - action: verify_baseline_integrity
      module: integrity-validator
      name: verify_baseline
      parameters:
        sample_percentage: 10
        verification_method: cross_check
      timeout: 180s
    success_actions:
    - activate_continuous_monitoring
    - notify_administrators
    - update_system_status
  - description: Continuous integrity monitoring workflow
    enabled: true
    failure_actions:
    - trigger_integrity_incident
    - isolate_affected_components
    - notify_security_team
    name: continuous-integrity-monitoring
    schedule: continuous
    steps:
    - action: monitor_changes
      module: integrity-validator
      name: monitor_file_changes
      parameters:
        batch_processing: false
        monitoring_interval: 60s
        real_time_notification: true
      timeout: continuous
    - action: verify_integrity
      module: integrity-validator
      name: verify_file_integrity
      parameters:
        deep_scan_enabled: false
        parallel_verification: true
        verification_method: hash_comparison
      timeout: 300s
    - action: detect_drift
      module: integrity-validator
      name: check_configuration_drift
      parameters:
        comparison_baseline: last_verified
        detailed_reporting: true
        drift_threshold: 0.01
      timeout: 180s
    success_actions:
    - update_integrity_status
    - log_verification_results
  recovery_mechanisms:
  - description: Automatic rollback to last known good state
    enabled: true
    name: automatic-rollback
    rollback_methods:
    - branch: main
      commit_reference: last_verified
      description: Rollback using version control
      name: version_control_rollback
      repository: system-configuration
    - backup_location: /secure/backups/integrity
      backup_type: incremental
      description: Restore from verified backup
      name: backup_restoration
      verification_required: true
    rollback_targets:
    - configuration_files
    - executable_modules
    - security_policies
    rollback_validation:
    - post_rollback_integrity_check
    - functional_verification
    - performance_baseline_comparison
    trigger_conditions:
    - integrity_violation_confirmed
    - critical_file_modified
    - unauthorized_configuration_change
  - description: Manual intervention recovery procedure
    enabled: true
    intervention_steps:
    - isolate_affected_system
    - gather_forensic_evidence
    - analyze_root_cause
    - plan_recovery_strategy
    - execute_recovery_with_approval
    - validate_recovery
    - document_incident
    name: manual-intervention
    required_approvals:
    - system_administrator
    - security_administrator
    - incident_commander
    trigger_conditions:
    - automatic_rollback_failed
    - complex_integrity_violation
    - system_state_ambiguous
status:
  conditions:
  - lastTransitionTime: '2025-12-20T22:00:00Z'
    message: Hash lock rules configured and active
    reason: RulesConfigured
    status: 'True'
    type: HashLockRulesConfigured
  - lastTransitionTime: '2025-12-20T22:00:00Z'
    message: Drift detection is enabled and monitoring
    reason: MonitoringActive
    status: 'True'
    type: DriftDetectionEnabled
  - lastTransitionTime: '2025-12-20T22:00:00Z'
    message: Integrity verification workflows are active
    reason: WorkflowsRunning
    status: 'True'
    type: IntegrityWorkflowsActive
  phase: Active
---
apiVersion: v1
data:
  schema.yaml: "# Root Integrity Configuration Schema\ntype: object\nproperties:\n\
    \  hash_lock_rules:\n    type: array\n    items:\n      type: object\n      properties:\n\
    \        name:\n          type: string\n        description:\n          type:\
    \ string\n        enabled:\n          type: boolean\n        scope:\n        \
    \  type: string\n        file_patterns:\n          type: array\n        hash_algorithm:\n\
    \          type: string\n        verification_frequency:\n          type: string\n\
    \        baseline_storage:\n          type: object\n        violation_actions:\n\
    \          type: array\n      required: [\"name\", \"description\", \"enabled\"\
    , \"scope\", \"file_patterns\", \"hash_algorithm\"]\n  drift_detection:\n    type:\
    \ array\n    items:\n      type: object\n      properties:\n        name:\n  \
    \        type: string\n        description:\n          type: string\n        enabled:\n\
    \          type: boolean\n        check_frequency:\n          type: string\n \
    \       comparison_baseline:\n          type: string\n        drift_threshold:\n\
    \          type: number\n        monitored_attributes:\n          type: array\n\
    \        alerting:\n          type: object\n      required: [\"name\", \"description\"\
    , \"enabled\", \"check_frequency\", \"comparison_baseline\", \"drift_threshold\"\
    ]\n  freeze_policies:\n    type: array\n    items:\n      type: object\n     \
    \ properties:\n        name:\n          type: string\n        description:\n \
    \         type: string\n        enabled:\n          type: boolean\n        schedule:\n\
    \          type: array\n        frozen_operations:\n          type: array\n  \
    \      exception_process:\n          type: object\n      required: [\"name\",\
    \ \"description\", \"enabled\", \"schedule\", \"frozen_operations\"]\nrequired:\
    \ [\"hash_lock_rules\", \"drift_detection\", \"freeze_policies\"]"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/integrity-schema
    eco-base/urn: urn:eco-base:k8s:core:configmap:integrity-schema:sha256-5ece062b10fac3e894e11af682746e56661c3b0b657dc3ca1eb601a9920b268e
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: integrity-schema
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: integrity-schema
  namespace: machinenativenops-integrity
