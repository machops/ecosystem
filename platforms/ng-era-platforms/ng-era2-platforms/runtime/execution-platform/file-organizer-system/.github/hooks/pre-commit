#!/bin/bash
# GL Governance Pre-Commit Hook for File Organizer System
set -e

echo "GL Unified Charter Activated - File Organizer Pre-Commit Validation"

# Check for GL metadata in changed files
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E 'file-organizer-system/.*\.(ts|tsx|js|json)$' || true)

if [ -n "$CHANGED_FILES" ]; then
  echo "Validating GL compliance for changed files..."
  
  for FILE in $CHANGED_FILES; do
    # Check for GL governance markers
    if ! grep -q "@GL-governed" "$FILE" 2>/dev/null; then
      echo "⚠️  Warning: $FILE missing @GL-governed marker"
    fi
    
    # Check for semantic annotations
    if grep -q "file-organizer-system" <<< "$FILE"; then
      if ! grep -q "@GL-layer:" "$FILE" 2>/dev/null; then
        echo "⚠️  Warning: $FILE missing @GL-layer marker"
      fi
    fi
  done
fi

# Run GL validation if engine files changed
if echo "$CHANGED_FILES" | grep -q "file-organizer-system/"; then
  echo "Running GL Engine validation for File Organizer..."
  cd file-organizer-system && npm run validate || {
    echo "❌ GL Validation Failed - Commit blocked"
    exit 1
  }
fi

echo "✓ GL Governance Pre-Commit Check Passed for File Organizer"