---
apiVersion: v1
data:
  alertmanager.yaml: "global:\n  resolve_timeout: 5m\n  slack_api_url: 'https://hooks.slack.com/services/${SLACK_WEBHOOK_ID}'\n\
    \  \ntemplates:\n- '/etc/alertmanager/templates/*.tmpl'\n\nroute:\n  receiver:\
    \ 'default-receiver'\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval:\
    \ 12h\n  group_by: ['alertname', 'cluster', 'service']\n  \n  routes:\n  # P0:\
    \ Critical alerts - immediate notification\n  - match:\n      severity: critical\n\
    \      priority: P0\n    receiver: 'critical-alerts'\n    group_wait: 10s\n  \
    \  repeat_interval: 5m\n    continue: true\n    \n  # P1: High severity alerts\n\
    \  - match:\n      severity: warning\n      priority: P1\n    receiver: 'high-alerts'\n\
    \    group_wait: 30s\n    repeat_interval: 15m\n    continue: true\n    \n  #\
    \ P2: Medium severity alerts\n  - match:\n      priority: P2\n    receiver: 'medium-alerts'\n\
    \    group_wait: 1m\n    repeat_interval: 1h\n    continue: true\n    \n  # P3:\
    \ Low severity alerts\n  - match:\n      priority: P3\n    receiver: 'low-alerts'\n\
    \    group_wait: 5m\n    repeat_interval: 4h\n\n# Inhibition rules\ninhibit_rules:\n\
    # Inhibit warning if critical is firing\n- source_match:\n    severity: 'critical'\n\
    \  target_match_re:\n    severity: 'warning'\n  equal: ['alertname', 'instance']\n\
    \  \n# Inherit same alertname and instance\n- source_match:\n    severity: 'critical'\n\
    \  target_match_re:\n    severity: '(warning|info)'\n  equal: ['alertname', 'cluster',\
    \ 'service']\n\nreceivers:\n- name: 'default-receiver'\n  slack_configs:\n  -\
    \ channel: '#alerts-default'\n    send_resolved: true\n    title: '{{ .Status\
    \ | toUpper }}{{ if eq .Status \"firing\" }}:{{ .Alerts.Firing | len }}{{ end\
    \ }} {{ .GroupLabels.alertname }}'\n    text: >-\n      {{ range .Alerts }}\n\
    \      *Alert:* {{ .Labels.alertname }}\n      *Severity:* {{ .Labels.severity\
    \ }}\n      *Priority:* {{ .Labels.priority }}\n      *Description:* {{ .Annotations.description\
    \ }}\n      *Details:* {{ .Annotations.runbook_url }}\n      {{ end }}\n  \n-\
    \ name: 'critical-alerts'\n  slack_configs:\n  - channel: '#alerts-critical'\n\
    \    send_resolved: true\n    title: '\U0001F534 CRITICAL: {{ .GroupLabels.alertname\
    \ }}'\n    color: 'danger'\n    text: >-\n      {{ range .Alerts }}\n      *Alert:*\
    \ {{ .Labels.alertname }}\n      *Cluster:* {{ .Labels.cluster }}\n      *Service:*\
    \ {{ .Labels.service }}\n      *Severity:* {{ .Labels.severity }}\n      *Description:*\
    \ {{ .Annotations.description }}\n      \n      *Runbook:* {{ .Annotations.runbook_url\
    \ }}\n      *Dashboard:* {{ .Annotations.dashboard_url }}\n      {{ end }}\n \
    \ \n  email_configs:\n  - to: 'oncall@example.com'\n    headers:\n      subject:\
    \ '\U0001F534 CRITICAL: {{ .GroupLabels.alertname }}'\n    html: |\n      {{ range\
    \ .Alerts }}\n      <h2>{{ .Labels.alertname }}</h2>\n      <p><strong>Severity:</strong>\
    \ {{ .Labels.severity }}</p>\n      <p><strong>Description:</strong> {{ .Annotations.description\
    \ }}</p>\n      <p><strong>Runbook:</strong> <a href=\"{{ .Annotations.runbook_url\
    \ }}\">{{ .Annotations.runbook_url }}</a></p>\n      {{ end }}\n  \n  pagerduty_configs:\n\
    \  - service_key: '${PAGERDUTY_SERVICE_KEY}'\n    severity: critical\n\n- name:\
    \ 'high-alerts'\n  slack_configs:\n  - channel: '#alerts-high'\n    send_resolved:\
    \ true\n    title: '\U0001F7E0 HIGH: {{ .GroupLabels.alertname }}'\n    color:\
    \ 'warning'\n    text: >-\n      {{ range .Alerts }}\n      *Alert:* {{ .Labels.alertname\
    \ }}\n      *Description:* {{ .Annotations.description }}\n      {{ end }}\n\n\
    - name: 'medium-alerts'\n  slack_configs:\n  - channel: '#alerts-medium'\n   \
    \ send_resolved: true\n    title: '\U0001F7E1 MEDIUM: {{ .GroupLabels.alertname\
    \ }}'\n    color: 'warning'\n    text: >-\n      {{ range .Alerts }}\n      *Alert:*\
    \ {{ .Labels.alertname }}\n      *Description:* {{ .Annotations.description }}\n\
    \      {{ end }}\n\n- name: 'low-alerts'\n  slack_configs:\n  - channel: '#alerts-low'\n\
    \    send_resolved: true\n    title: '\U0001F7E2 LOW: {{ .GroupLabels.alertname\
    \ }}'\n    color: 'good'\n    text: >-\n      {{ range .Alerts }}\n      *Alert:*\
    \ {{ .Labels.alertname }}\n      *Description:* {{ .Annotations.description }}\n\
    \      {{ end }}\n"
kind: ConfigMap
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/configmap/alertmanager
    eco-base/urn: urn:eco-base:k8s:core:configmap:alertmanager:sha256-33df56f9b082c2de4086d2238e4a8d4681768e02b805280cddc6b5d5be6560d7
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: alertmanager
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/governance: aligned
    eco-base/owner: eco-system
    eco-base/part-of: eco-base
    eco-base/platform: core
    environment: dev
    managed-by: gl-platform
    version: 1.0.0
  name: alertmanager
  namespace: monitoring
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    eco-base/audit-log-level: minimal
    eco-base/governance-policy: standard-v1
    eco-base/uri: eco-base://k8s/core/secret/alertmanager-secrets
    eco-base/urn: urn:eco-base:k8s:core:secret:alertmanager-secrets:sha256-95104e9a7d57b6aa6b7f9f0bd959ad99a040ca99eefe0efa6015f95e0526db30
  labels:
    app.kubernetes.io/component: eco-component
    app.kubernetes.io/instance: eco-instance
    app.kubernetes.io/name: alertmanager-secrets
    app.kubernetes.io/part-of: eco-base
    app.kubernetes.io/version: 1.0.0
    eco-base/environment: development
    eco-base/owner: eco-system
    eco-base/platform: core
  name: alertmanager-secrets
  namespace: monitoring
stringData:
  pagerduty-service-key: ${PAGERDUTY_SERVICE_KEY}
  slack-webhook-id: ${SLACK_WEBHOOK_ID}
