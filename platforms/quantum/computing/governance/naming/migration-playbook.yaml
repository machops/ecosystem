# @ECO-layer: GQS-L0
# @ECO-governed
# @ECO-layer: GL90-99
# @ECO-semantic: naming-governance
# @ECO-audit-trail: gl-enterprise-architecture/governance/audit-trails/GL90_99-audit.json
#
# GL Unified Architecture Governance Framework Activated
# GL Root Semantic Anchor: gl-enterprise-architecture/governance/ECO-ROOT-SEMANTIC-ANCHOR.yaml
# GL Unified Naming Charter: gl-enterprise-architecture/governance/ECO-UNIFIED-NAMING-CHARTER.yaml


apiVersion: migration.machinenativeops.io/v1
kind: NamingMigrationPlaybook
metadata:
  annotations:
    eco-base/urn: "urn:eco-base:platform:resource:quantum:computing:governance:naming:migration-playbook.yaml"
    eco-base/uri: "eco-base://platform/resource/quantum/computing/governance/naming/migration-playbook.yaml"
  name: gl-quantum-naming-migration
  namespace: governance
  labels:
    eco-base/part-of: eco-base
    eco-base/governance: aligned
    gl-version: v10.0.0
    tier: quantum-naming
spec:
  phases:
    - name: discovery
      order: 1
      duration: 2h
      description: Discover all non-compliant resources
      
      steps:
        - name: scan-kubernetes-cluster
          tool: kubectl
          command: |
            kubectl get all --all-namespaces -o json > discovery/all-resources.json
            
        - name: analyze-naming-compliance
          tool: python
          script: scripts/analyze-naming.py
          input: discovery/all-resources.json
          output: discovery/compliance-report.json
            
        - name: generate-inventory
          tool: python
          script: scripts/generate-inventory.py
          input: discovery/compliance-report.json
          output: migration/inventory.csv
          
    - name: planning
      order: 2
      duration: 4h
      description: Create detailed migration plan
      
      steps:
        - name: create-migration-plan
          tool: python
          script: scripts/create-migration-plan.py
          input: migration/inventory.csv
          output: migration/plan.json
          
        - name: risk-assessment
          tool: python
          script: scripts/risk-assessment.py
          input: migration/plan.json
          output: migration/risk-assessment.md
          
        - name: schedule-migration
          tool: python
          script: scripts/schedule-migration.py
          input: migration/plan.json
          output: migration/schedule.json
          
    - name: dry-run
      order: 3
      duration: 2h
      description: Validate migration with dry-run
      
      steps:
        - name: validate-changes
          tool: kubectl
          command: |
            kubectl apply --dry-run=server -f migration/changes.yaml
            
        - name: generate-diff-report
          tool: kubectl
          command: |
            kubectl diff -f migration/changes.yaml > migration/diff-report.txt
            
        - name: test-connectivity
          tool: python
          script: scripts/test-connectivity.py
          input: migration/plan.json
          
    - name: staged-rename
      order: 4
      duration: 8h
      description: Execute migration in stages
      
      steps:
        - name: backup-current-state
          tool: python
          script: scripts/backup-state.py
          output: migration/backup/
          
        - name: apply-staged-changes
          tool: kubectl
          command: |
            kubectl apply -f migration/stage1-changes.yaml
            kubectl wait --for=condition=ready --timeout=5m -f migration/stage1-changes.yaml
            kubectl apply -f migration/stage2-changes.yaml
            kubectl wait --for=condition=ready --timeout=5m -f migration/stage2-changes.yaml
            
        - name: verify-migration
          tool: python
          script: scripts/verify-migration.py
          input: migration/plan.json
          output: migration/verification-report.json
          
    - name: cutover
      order: 5
      duration: 2h
      description: Switch traffic to new resources
      
      steps:
        - name: update-dns
          tool: python
          script: scripts/update-dns.py
          input: migration/plan.json
          
        - name: switch-ingress
          tool: kubectl
          command: |
            kubectl apply -f migration/cutover-ingress.yaml
            
        - name: monitor-health
          tool: prometheus
          queries:
            - up{job="kubernetes-pods"}
            - http_requests_total{status="5xx"}
            
    - name: rollback
      order: 6
      duration: 20m
      description: Rollback procedure (if needed)
      
      steps:
        - name: restore-backup
          tool: python
          script: scripts/restore-backup.py
          input: migration/backup/
          
        - name: revert-dns
          tool: python
          script: scripts/revert-dns.py
          
        - name: restore-ingress
          tool: kubectl
          command: |
            kubectl apply -f migration/original-ingress.yaml
            
  safety:
    maxRollbackTime: 20m
    requireApproval: true
    approvalThreshold: 2
    healthCheckEndpoints:
      - /health
      - /ready
      - /metrics
      
  validation:
    preMigration:
      - health-check
      - connectivity-test
      - capacity-check
      
    postMigration:
      - health-check
      - traffic-validation
      - compliance-verification