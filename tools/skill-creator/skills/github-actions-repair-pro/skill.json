{
  "id": "github-actions-repair-pro",
  "name": "GitHub Actions Repair Pro",
  "version": "1.0.0",
  "description": "End-to-end automated diagnosis and repair of GitHub Actions CI/CD pipeline failures. Implements Understanding \u2192 Retrieval \u2192 Analysis \u2192 Reasoning \u2192 One-Stop Repair with root cause elimination and regression prevention.",
  "category": "ci-cd-repair",
  "triggers": [
    {
      "type": "webhook",
      "config": {
        "event": "workflow_run.completed",
        "filter": "conclusion == 'failure'",
        "branches": [
          "main",
          "develop"
        ]
      }
    },
    {
      "type": "event",
      "config": {
        "source": "github",
        "event_type": "check_run.completed",
        "filter": "conclusion == 'failure'"
      }
    },
    {
      "type": "manual",
      "config": {
        "description": "Manually trigger repair for a specific workflow run"
      }
    }
  ],
  "actions": [
    {
      "id": "understand",
      "name": "Understanding \u2014 Build Mental Model",
      "type": "shell",
      "config": {
        "command": "bash actions/understand.sh",
        "env": {
          "REPO": "{{ .repository }}",
          "RUN_ID": "{{ .run_id }}"
        },
        "timeout_seconds": 30
      },
      "depends_on": [],
      "retry": {
        "max_attempts": 2,
        "backoff_ms": 1000
      }
    },
    {
      "id": "retrieve-logs",
      "name": "Retrieval \u2014 Fetch Failure Logs",
      "type": "api",
      "config": {
        "method": "GET",
        "url": "https://api.github.com/repos/{{ .repository }}/actions/runs/{{ .run_id }}/logs",
        "headers": {
          "Authorization": "Bearer {{ .github_token }}",
          "Accept": "application/vnd.github+json"
        },
        "expected_status": [
          200,
          302
        ]
      },
      "depends_on": [
        "understand"
      ],
      "retry": {
        "max_attempts": 3,
        "backoff_ms": 2000
      }
    },
    {
      "id": "retrieve-workflow",
      "name": "Retrieval \u2014 Fetch Workflow Definition",
      "type": "shell",
      "config": {
        "command": "bash actions/retrieve-workflow.sh",
        "env": {
          "REPO": "{{ .repository }}",
          "RUN_ID": "{{ .run_id }}"
        },
        "timeout_seconds": 15
      },
      "depends_on": [
        "understand"
      ],
      "retry": {
        "max_attempts": 2,
        "backoff_ms": 1000
      }
    },
    {
      "id": "retrieve-dockerfile",
      "name": "Retrieval \u2014 Fetch Dockerfile & Build Context",
      "type": "shell",
      "config": {
        "command": "bash actions/retrieve-dockerfile.sh",
        "env": {
          "REPO": "{{ .repository }}"
        },
        "timeout_seconds": 15
      },
      "depends_on": [
        "understand"
      ],
      "retry": {
        "max_attempts": 2,
        "backoff_ms": 1000
      }
    },
    {
      "id": "analyze",
      "name": "Analysis \u2014 Root Cause Identification",
      "type": "transform",
      "config": {
        "input_path": "retrieve-logs.output",
        "output_path": "analysis.json",
        "rules": [
          "Match error patterns against failure taxonomy (yaml-syntax, dockerfile-path, identity-drift, governance-missing, schema-violation)",
          "Identify YAML parser errors at specific line/column",
          "Detect Dockerfile COPY path mismatches against build context",
          "Check for stale identity references (superai, SUPERAI_ etc.)",
          "Verify .qyaml governance block completeness",
          "Identify dependency resolution failures",
          "Detect environment/runner compatibility issues"
        ]
      },
      "depends_on": [
        "retrieve-logs",
        "retrieve-workflow",
        "retrieve-dockerfile"
      ],
      "retry": {
        "max_attempts": 1,
        "backoff_ms": 1000
      }
    },
    {
      "id": "reason",
      "name": "Reasoning \u2014 Solution Derivation",
      "type": "transform",
      "config": {
        "input_path": "analysis.json",
        "output_path": "solution.json",
        "rules": [
          "Map each root cause to a specific repair strategy",
          "yaml-syntax \u2192 heredoc replacement for inline code blocks",
          "dockerfile-path \u2192 rewrite COPY paths relative to build context",
          "identity-drift \u2192 global search-replace with verification",
          "governance-missing \u2192 inject 4-block governance stamp",
          "schema-violation \u2192 regenerate from schema template",
          "Evaluate side effects of each proposed change",
          "Select minimal-impact fix path",
          "Generate concrete file modifications as unified diff"
        ]
      },
      "depends_on": [
        "analyze"
      ],
      "retry": {
        "max_attempts": 1,
        "backoff_ms": 1000
      }
    },
    {
      "id": "consolidate",
      "name": "One-Stop Repair \u2014 Consolidate Changes",
      "type": "transform",
      "config": {
        "input_path": "solution.json",
        "output_path": "consolidated_patch.diff",
        "rules": [
          "Merge all file modifications into single unified patch",
          "Resolve conflicts between overlapping changes",
          "Eliminate redundant modifications",
          "Ensure consistent formatting across all changed files",
          "Validate patch applies cleanly to current HEAD"
        ]
      },
      "depends_on": [
        "reason"
      ],
      "retry": {
        "max_attempts": 1,
        "backoff_ms": 1000
      }
    },
    {
      "id": "integrate",
      "name": "One-Stop Repair \u2014 Apply & Integrate",
      "type": "shell",
      "config": {
        "command": "bash actions/integrate.sh",
        "env": {
          "COMMIT_MSG": "{{ .commit_message }}",
          "BRANCH": "{{ .branch }}"
        },
        "timeout_seconds": 60
      },
      "depends_on": [
        "consolidate"
      ],
      "retry": {
        "max_attempts": 1,
        "backoff_ms": 2000
      }
    },
    {
      "id": "validate-fix",
      "name": "One-Stop Repair \u2014 Trigger Verification CI",
      "type": "api",
      "config": {
        "method": "POST",
        "url": "https://api.github.com/repos/{{ .repository }}/actions/workflows/{{ .workflow_file }}/dispatches",
        "headers": {
          "Authorization": "Bearer {{ .github_token }}",
          "Accept": "application/vnd.github+json"
        },
        "body": {
          "ref": "{{ .branch }}"
        },
        "expected_status": [
          204
        ]
      },
      "depends_on": [
        "integrate"
      ],
      "retry": {
        "max_attempts": 1,
        "backoff_ms": 5000
      }
    },
    {
      "id": "monitor",
      "name": "One-Stop Repair \u2014 Monitor Re-run Until Conclusion",
      "type": "shell",
      "config": {
        "command": "bash actions/monitor.sh",
        "env": {
          "REPO": "{{ .repository }}"
        },
        "timeout_seconds": 360
      },
      "depends_on": [
        "validate-fix"
      ],
      "retry": {
        "max_attempts": 1,
        "backoff_ms": 10000
      }
    }
  ],
  "inputs": [
    {
      "name": "repository",
      "type": "string",
      "required": true,
      "description": "GitHub repository (owner/repo)"
    },
    {
      "name": "run_id",
      "type": "string",
      "required": true,
      "description": "Failed workflow run ID"
    },
    {
      "name": "github_token",
      "type": "string",
      "required": true,
      "description": "GitHub PAT with actions and contents scope"
    },
    {
      "name": "branch",
      "type": "string",
      "required": false,
      "default": "main",
      "description": "Target branch"
    },
    {
      "name": "workflow_file",
      "type": "string",
      "required": false,
      "default": "ci.yaml",
      "description": "Workflow filename for re-trigger"
    },
    {
      "name": "commit_message",
      "type": "string",
      "required": false,
      "default": "fix: automated CI/CD repair",
      "description": "Commit message for fix"
    }
  ],
  "outputs": [
    {
      "name": "root_cause",
      "type": "string",
      "required": true,
      "description": "Identified root cause of failure"
    },
    {
      "name": "fix_applied",
      "type": "boolean",
      "required": true,
      "description": "Whether fix was successfully applied"
    },
    {
      "name": "verification_status",
      "type": "string",
      "required": true,
      "description": "Post-fix verification result: success|failure|timeout"
    },
    {
      "name": "patch_diff",
      "type": "string",
      "required": false,
      "description": "Applied patch in unified diff format"
    },
    {
      "name": "commit_sha",
      "type": "string",
      "required": false,
      "description": "SHA of the fix commit"
    },
    {
      "name": "error_taxonomy",
      "type": "object",
      "required": false,
      "description": "Classified error details with category, severity, file, line"
    }
  ],
  "governance": {
    "owner": "platform-team",
    "approval_chain": [
      "platform-team",
      "devops-lead"
    ],
    "compliance_tags": [
      "ci-cd",
      "automation",
      "self-healing",
      "zero-trust",
      "slsa-l3",
      "audit-trail",
      "soc2-compliant"
    ],
    "lifecycle_policy": "active"
  },
  "metadata": {
    "unique_id": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
    "uri": "eco-base://skills/github-actions-repair-pro",
    "urn": "urn:eco-base:skills:github-actions-repair-pro:6ba7b810-9dad-11d1-80b4-00c04fd430c8",
    "schema_version": "1.0.0",
    "target_system": "github-actions",
    "generated_by": "skill-creator-v1",
    "created_at": "2025-02-18T00:00:00Z",
    "updated_at": "2025-02-18T00:00:00Z"
  }
}